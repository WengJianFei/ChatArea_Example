!function(){function t(t,e,n){return(e=s(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e=function(){return n};var t,n={},i=Object.prototype,a=i.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function d(t,e,n,i){var a=e&&e.prototype instanceof x?e:x,o=Object.create(a.prototype),s=new P(i||[]);return r(o,"_invoke",{value:w(t,n,s)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=d;var g="suspendedStart",m="suspendedYield",f="executing",E="completed",v={};function x(){}function D(){}function y(){}var C={};h(C,s,(function(){return this}));var b=Object.getPrototypeOf,T=b&&b(b(S([])));T&&T!==i&&a.call(T,s)&&(C=T);var k=y.prototype=x.prototype=Object.create(C);function A(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function n(i,r,o,s){var c=p(t[i],t,r);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==u(h)&&a.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(h).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,s)}))}s(c.arg)}var i;r(this,"_invoke",{value:function(t,a){function r(){return new e((function(e,i){n(t,a,e,i)}))}return i=i?i.then(r,r):r()}})}function w(e,n,i){var a=g;return function(r,o){if(a===f)throw Error("Generator is already running");if(a===E){if("throw"===r)throw o;return{value:t,done:!0}}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var c=L(s,i);if(c){if(c===v)continue;return c}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===g)throw a=E,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=f;var l=p(e,n,i);if("normal"===l.type){if(a=i.done?E:m,l.arg===v)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(a=E,i.method="throw",i.arg=l.arg)}}}function L(e,n){var i=n.method,a=e.iterator[i];if(a===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var r=p(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function S(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(u(e)+" is not iterable")}return D.prototype=y,r(k,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:D,configurable:!0}),D.displayName=h(y,l,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===D||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,h(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},n.awrap=function(t){return{__await:t}},A(I.prototype),h(I.prototype,c,(function(){return this})),n.AsyncIterator=I,n.async=function(t,e,i,a,r){void 0===r&&(r=Promise);var o=new I(d(t,e,i,a),r);return n.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},A(k),h(k,l,"Generator"),h(k,s,(function(){return this})),h(k,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},n.values=S,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(i,a){return s.type="throw",s.arg=e,n.next=i,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),F(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;F(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:S(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),v}},n}function n(t,e,n,i,a,r,o){try{var s=t[r](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,a)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(a,r){var o=t.apply(e,i);function s(t){n(o,a,r,s,c,"next",t)}function c(t){n(o,a,r,s,c,"throw",t)}s(void 0)}))}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=u(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}function c(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return l(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}System.register([],(function(n,r){"use strict";return{execute:function(){var r=Object.defineProperty,s=function(t,e,n){return function(t,e,n){e in t?r(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n}(t,"symbol"!=u(e)?e+"":e,n),n};function l(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"block";t&&(t.className=t.className.replace(/ chat-view-show| chat-view-hidden/g,""),e?(t.style.display=n,t.className+=" chat-view-show"):(t.className+=" chat-view-hidden",t.style.display="none"))}function h(t){return t&&t.classList.contains("chat-view-show")}function d(t,e,n){t.classList[n?"add":"remove"](e)}!function(){var t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){var e,n=c(document.querySelectorAll('link[rel="modulepreload"]'));try{for(n.s();!(e=n.n()).done;){i(e.value)}}catch(a){n.e(a)}finally{n.f()}new MutationObserver((function(t){var e,n=c(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if("childList"===r.type){var o,s=c(r.addedNodes);try{for(s.s();!(o=s.n()).done;){var l=o.value;"LINK"===l.tagName&&"modulepreload"===l.rel&&i(l)}}catch(a){s.e(a)}finally{s.f()}}}}catch(a){n.e(a)}finally{n.f()}})).observe(document,{childList:!0,subtree:!0})}function i(t){if(!t.ep){t.ep=!0;var e=function(t){var e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}}();var p="data-set-empty",g="data-set-richType",m="richWrap",f="richGrid",E="richMark",v="richInput",x="richTag",D=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return new Promise((function(e){setTimeout(e,t)}))},y=function(t){return"false"!==String(t)&&"null"!==String(t)&&"0"!==String(t)},C=function(t,e){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];var s=this,c=i&&!n;clearTimeout(n),n=setTimeout((function(){n=null,i||t.apply(s,r)}),e),c&&t.apply(s,r)}},b=function(t,e){var n;return function(){for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];n||(t.apply(this,a),n=!0,setTimeout((function(){n=!1}),e))}},T=function(t,e,n){return t=t.toLowerCase(),e=e.toLowerCase(),n=(n=n.toLowerCase()).replace(/\s/g,""),!/(?:[!-\/:-@\[-`\{-~\xA1-\xA9\xAB\xAC\xAE-\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u0482\u055A-\u055F\u0589\u058A\u058D-\u058F\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060F\u061B\u061D-\u061F\u066A-\u066D\u06D4\u06DE\u06E9\u06FD\u06FE\u0700-\u070D\u07F6-\u07F9\u07FE\u07FF\u0830-\u083E\u085E\u0888\u0964\u0965\u0970\u09F2\u09F3\u09FA\u09FB\u09FD\u0A76\u0AF0\u0AF1\u0B70\u0BF3-\u0BFA\u0C77\u0C7F\u0C84\u0D4F\u0D79\u0DF4\u0E3F\u0E4F\u0E5A\u0E5B\u0F01-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0F3A-\u0F3D\u0F85\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE-\u0FDA\u104A-\u104F\u109E\u109F\u10FB\u1360-\u1368\u1390-\u1399\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DB\u1800-\u180A\u1940\u1944\u1945\u19DE-\u19FF\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B4E\u1B4F\u1B5A-\u1B6A\u1B74-\u1B7F\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u20A0-\u20C0\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u218A\u218B\u2190-\u2429\u2440-\u244A\u249C-\u24E9\u2500-\u2775\u2794-\u2B73\u2B76-\u2B95\u2B97-\u2BFF\u2CE5-\u2CEA\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E5D\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFF\u3001-\u3004\u3008-\u3020\u3030\u3036\u3037\u303D-\u303F\u309B\u309C\u30A0\u30FB\u3190\u3191\u3196-\u319F\u31C0-\u31E5\u31EF\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAA77-\uAA79\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC2\uFD3E-\uFD4F\uFDCF\uFDFC-\uFDFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD]|\uD800[\uDD00-\uDD02\uDD37-\uDD3F\uDD79-\uDD89\uDD8C-\uDD8E\uDD90-\uDD9C\uDDA0\uDDD0-\uDDFC\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDC77\uDC78\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEC8\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDD6E\uDD8E\uDD8F\uDEAD\uDF55-\uDF59\uDF86-\uDF89]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9\uDFD4\uDFD5\uDFD7\uDFD8]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDEB9\uDF3C-\uDF3F]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2\uDF00-\uDF09\uDFE1]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDF43-\uDF4F\uDFD5-\uDFF1\uDFFF]|\uD809[\uDC70-\uDC74]|\uD80B[\uDFF1\uDFF2]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3F\uDF44\uDF45]|\uD81B[\uDD6D-\uDD6F\uDE97-\uDE9A\uDFE2]|\uD82F[\uDC9C\uDC9F]|\uD833[\uDC00-\uDCEF\uDD00-\uDEB3\uDF50-\uDFC3]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDEA\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDC00-\uDDFF\uDE37-\uDE3A\uDE6D-\uDE74\uDE76-\uDE83\uDE85-\uDE8B]|\uD838[\uDD4F\uDEFF]|\uD839\uDDFF|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDCAC\uDCB0\uDD2E\uDEF0\uDEF1]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBF\uDCC1-\uDCCF\uDCD1-\uDCF5\uDD0D-\uDDAD\uDDE6-\uDE02\uDE10-\uDE3B\uDE40-\uDE48\uDE50\uDE51\uDE60-\uDE65\uDF00-\uDFFF]|\uD83D[\uDC00-\uDED7\uDEDC-\uDEEC\uDEF0-\uDEFC\uDF00-\uDF76\uDF7B-\uDFD9\uDFE0-\uDFEB\uDFF0]|\uD83E[\uDC00-\uDC0B\uDC10-\uDC47\uDC50-\uDC59\uDC60-\uDC87\uDC90-\uDCAD\uDCB0-\uDCBB\uDCC0\uDCC1\uDD00-\uDE53\uDE60-\uDE6D\uDE70-\uDE7C\uDE80-\uDE89\uDE8F-\uDEC6\uDECE-\uDEDC\uDEDF-\uDEE9\uDEF0-\uDEF8\uDF00-\uDF92\uDF94-\uDFEF])/.test(n)&&k(t,e||t,n)},k=function(t,e,n){if(!n)return!1;var i=A(n),a=i.chinesePart,r=i.pinyinPart,o=i.numberPart;if(a&&!t.startsWith(a)||o&&!t.includes(o))return!1;var s=e.replace(/\s+/g,"").toLowerCase();return!(r&&!w(r,s))},A=function(t){var e,n="",i="",a="",r=null,o=c(t);try{for(o.s();!(e=o.n()).done;){var s=e.value;I(s)?(r="chinese",n+=s):/[a-zA-Z]/.test(s)?(r="pinyin",i+=s.toLowerCase()):/\d/.test(s)?(r="number",a+=s):r=null}}catch(l){o.e(l)}finally{o.f()}return{chinesePart:n,pinyinPart:i,numberPart:a,currentType:r}},I=function(t){var e=t.charCodeAt(0);return e>=19968&&e<=40959||e>=13312&&e<=19903||e>=131072&&e<=173791},w=function(t,e){var n,i=0,a=c(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(i>=t.length)break;r===t[i]&&i++}}catch(o){a.e(o)}finally{a.f()}return i===t.length},L=function(t,e){var n=t.getAttribute(g);return n===f?null:n===E||n===x?t:t.parentElement&&e>0?L(t.parentElement,e-1):null},N=function(t,e,n){return t&&t[e]?t[e]:n},F='<div class="ant-spin ant-spin-spinning" aria-live="polite" aria-busy="true"><span class="ant-spin-dot ant-spin-dot-spin"><i class="ant-spin-dot-item"></i><i class="ant-spin-dot-item"></i><i class="ant-spin-dot-item"></i><i class="ant-spin-dot-item"></i></span></div>',P='<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="m20.23 8.653-7.795 9.685a1.2 1.2 0 0 1-1.87 0L2.771 8.652C2.14 7.867 2.698 6.7 3.706 6.7h15.588c1.008 0 1.567 1.167.935 1.952"></path></svg>',S=function(){return o((function t(e){a(this,t),s(this,"target"),s(this,"richText",document.createElement("div")),s(this,"placeholderElm",document.createElement("div")),s(this,"tipElm",null),s(this,"isExternalCallPopup",!1),s(this,"isPointSearchMode",!1),s(this,"checkboxRows",[]),s(this,"customTags",{}),s(this,"selectTags",{}),s(this,"rects",{}),s(this,"pcElms",{containerDialogElm:null,pointDialogElm:null,pointDialogCheckElm:null,pointDialogMainElm:null,pointDialogUsersElm:[],pointDialogActiveElm:null,pointDialogLoadingElm:null,pointDialogEmptyElm:null,checkDialogElm:null,checkDialogSearchResultElm:null,checkDialogUsersElm:null,checkDialogSearchInputElm:null,checkDialogTagsElm:null,customTagDialogElms:{},customTagDialogTagKey:"",customTagDialogActiveElm:null,selectDialogElms:{},selectDialogKey:"",selectDialogAim:null,tipPopoverElm:null}),s(this,"h5Elms",{dialogElm:null,dialogMainElm:null,dialogCheckElm:null,dialogShowElm:null,dialogSearchElm:null,dialogEmptyElm:null,dialogLoadingElm:null}),this.target=e,this.createRichText(),this.createPlaceholder(),e.deviceInfo.isPc?this.createPCDialog():this.createH5Dialog()}),[{key:"createRichText",value:function(){var t=this.target,e=t.options,n=t.deviceInfo,i=e.elm;d(i,"chat-area-".concat(n.isPc?"pc":"h5"),!0),d(this.richText,"chat-rich-text",!0),this.richText.setAttribute(g,m),this.richText.setAttribute("contenteditable","true"),i.appendChild(this.richText)}},{key:"createPlaceholder",value:function(){var t=this.target.options.elm;d(this.placeholderElm,"chat-placeholder-wrap",!0),l(this.placeholderElm,!0),t.appendChild(this.placeholderElm),this.rects.plaRect=this.placeholderElm.getBoundingClientRect()}},{key:"createPCDialog",value:function(){var t=this.target.options,e=t.needDialog,n=t.elm,i=t.asyncMatch;if(e){var a=this.pcElms;if(a.containerDialogElm=document.createElement("div"),d(this.pcElms.containerDialogElm,"chat-dialog",!0),!n.parentElement)throw new Error('配置项："elm" 需要存在一个父级元素，请检查后重新配置！');n.nextElementSibling?n.parentElement.insertBefore(a.containerDialogElm,n.nextElementSibling):n.parentElement.appendChild(a.containerDialogElm),i||this.createPCCheckDialog(),this.createPCPointDialog()}}},{key:"createPCCheckDialog",value:function(){var t=this,n=this.target.options,a=this.target.options.dialogLabels.pcPCheckDialog,r=this.pcElms;r.checkDialogElm=document.createElement("div"),d(r.checkDialogElm,"checkbox-dialog",!0),l(r.checkDialogElm),r.checkDialogElm.innerHTML='\n          <div class="checkbox-dialog-container">\n            <div class="checkbox-dialog-container-header">\n                <span>'.concat(a.title,'</span>\n                <span class="checkbox-dialog-container-header-close">⛌</span>\n            </div>\n            <div class="checkbox-dialog-container-body">\n                <div class="checkbox-dialog-left-box">\n                    <div class="checkbox-dialog-search">\n                        <input class="checkbox-dialog-search-input" placeholder="').concat(a.searchPlaceholder,'" type="text">\n                        <div class="checkbox-dialog-search-group"></div>\n                    </div>\n                    <div class="checkbox-dialog-tags"></div>\n                    <div class="checkbox-dialog-option">\n                        <button class="checkbox-dialog-option-btn btn-submit disabled">').concat(a.confirmLabel,'</button>\n                        <button class="checkbox-dialog-option-btn btn-close">').concat(a.cancelLabel,'</button>\n                    </div>\n                </div>\n                <div class="checkbox-dialog-right-box">\n                    <div class="checkbox-dialog-right-box-title">').concat(a.userTagTitle,'</div>\n                    <div class="checkbox-dialog-check-group"></div>\n                </div>\n            </div>\n          </div>\n        '),r.containerDialogElm.appendChild(r.checkDialogElm),r.checkDialogUsersElm=r.checkDialogElm.querySelector(".checkbox-dialog-check-group"),r.checkDialogSearchResultElm=r.checkDialogElm.querySelector(".checkbox-dialog-search-group"),r.checkDialogSearchInputElm=r.checkDialogElm.querySelector(".checkbox-dialog-search-input"),r.checkDialogTagsElm=r.checkDialogElm.querySelector(".checkbox-dialog-tags");var o=function(){l(r.checkDialogElm),d(document.body,"disable-scroll")};r.checkDialogElm.querySelector(".checkbox-dialog-container-header-close").onclick=o,r.checkDialogElm.querySelector(".btn-close").onclick=o;var s=r.checkDialogElm.querySelector(".btn-submit");s.onclick=i(e().mark((function i(){var a;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.classList.contains("disabled")){e.next=2;break}return e.abrupt("return");case 2:return a=t.checkboxRows.map((function(t){var e=Object.create(null);return e[n.userProps.id]=t.id,e[n.userProps.name]=t.name,e})),e.next=5,t.target.batchSetTag(a);case 5:o();case 6:case"end":return e.stop()}}),i)}))),l(r.checkDialogSearchResultElm),r.checkDialogSearchResultElm.onclick=function(t){t.stopPropagation()},r.checkDialogSearchInputElm.onclick=function(t){t.stopPropagation()};var c=C((function(e){var n=String(e.target.value||"").replace(/'/g,"").trim();if(n){var i=t.target.searchUserList(n).map((function(t){return t.id}));Array.from(r.checkDialogSearchResultElm.children,(function(t,e){if(e===r.checkDialogSearchResultElm.children.length-1)l(t,0===i.length);else{var n=t.getAttribute("data-set-id");l(t,-1!==i.indexOf(n),"flex")}})),l(r.checkDialogSearchResultElm,!0)}else l(r.checkDialogSearchResultElm)}),200);r.checkDialogSearchInputElm.oninput=c,r.checkDialogSearchInputElm.onfocus=c}},{key:"createPCPointDialog",value:function(){var t=this,e=this.pcElms,n=this.target;e.pointDialogElm=document.createElement("div"),d(e.pointDialogElm,"call-user-dialog",!0),l(e.pointDialogElm);var i=document.createElement("div");d(i,"call-user-dialog-header",!0),i.innerHTML='<span class="call-user-dialog-header-title">'.concat(n.options.dialogLabels.pcPointDialog.title,"</span>"),e.pointDialogCheckElm=document.createElement("span"),d(e.pointDialogCheckElm,"call-user-dialog-header-check",!0),e.pointDialogCheckElm.innerText=n.options.dialogLabels.pcPointDialog.checkLabel,e.pointDialogCheckElm.onclick=function(){t.target.showPCCheckDialog(),t.isExternalCallPopup=!1},i.appendChild(e.pointDialogCheckElm),e.pointDialogElm.appendChild(i),e.pointDialogMainElm=document.createElement("div"),d(e.pointDialogMainElm,"call-user-dialog-main",!0),e.pointDialogElm.appendChild(e.pointDialogMainElm),n.options.asyncMatch&&(e.pointDialogLoadingElm=document.createElement("div"),d(e.pointDialogLoadingElm,"call-user-dialog-loading",!0),e.pointDialogLoadingElm.innerHTML=F,e.pointDialogElm.appendChild(e.pointDialogLoadingElm),l(e.pointDialogLoadingElm),e.pointDialogEmptyElm=document.createElement("div"),d(e.pointDialogEmptyElm,"call-user-dialog-empty",!0),e.pointDialogEmptyElm.innerHTML="\n                ".concat('<svg class="match-empty-svg" viewBox="0 0 64 41" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 1)" fill="none" fill-rule="evenodd"><ellipse fill="#f5f5f5" cx="32" cy="33" rx="32" ry="7"></ellipse><g fill-rule="nonzero" stroke="#d9d9d9"><path d="M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"></path><path d="M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z" fill="#fafafa"></path></g></g></svg>','\n                <span class="empty-label">').concat(n.options.dialogLabels.pcPointDialog.emptyLabel,"</span>\n            "),e.pointDialogElm.appendChild(e.pointDialogEmptyElm),l(e.pointDialogEmptyElm)),e.containerDialogElm.appendChild(e.pointDialogElm)}},{key:"createH5Dialog",value:function(){var n=this,a=this.target,r=a.options,o=a.chatEvent,s=r.needDialog,c=r.dialogLabels;if(s){var u=this.h5Elms;u.dialogElm=document.createElement("div"),d(u.dialogElm,"call-user-popup",!0),u.dialogElm.innerHTML='\n          <div class="call-user-popup-main">\n            <div class="call-user-popup-header">\n                <span class="popup-show">'.concat(c.h5Dialog.cancelLabel,'</span>\n                <span class="popup-title">').concat(c.h5Dialog.title,'</span>\n                <span class="popup-check">').concat(c.h5Dialog.confirmLabel,'</span>\n            </div>\n            <div class="call-user-popup-search">\n                ').concat('<svg class="icon-search" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M684.8 223.530667a326.272 326.272 0 0 1 24.96 433.621333c2.645333 2.133333 5.290667 4.48 7.850667 7.04L870.4 817.066667c24.789333 24.746667 32.896 56.832 18.133333 71.594666-14.762667 14.805333-46.848 6.656-71.637333-18.090666l-152.789333-152.832a106.282667 106.282667 0 0 1-7.210667-7.936 326.101333 326.101333 0 0 1-433.109333-25.173334c-127.445333-127.445333-127.573333-333.952-0.256-461.269333 127.36-127.36 333.866667-127.232 461.269333 0.213333zM275.328 275.114667a252.885333 252.885333 0 0 0 0.256 357.632 252.885333 252.885333 0 0 0 357.632 0.256 252.885333 252.885333 0 0 0-0.256-357.632 252.885333 252.885333 0 0 0-357.632-0.256z" fill="#9B9B9B"></path></svg>','\n                <input class="call-user-popup-search-input"\n                       placeholder="').concat(c.h5Dialog.searchPlaceholder,'"\n                       type="text">\n            </div>\n            <div class="call-user-popup-body"></div>\n          </div>\n        ');var h=function(){var t=i(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u.dialogElm.className=u.dialogElm.className.replace(/ chat-view-show/g," chat-view-hidden"),u.dialogSearchElm.value="",t.next=4,D(260);case 4:l(u.dialogElm),d(document.body,"disable-scroll"),r.asyncMatch&&n.target.updateUserList([]),n.target.chatInput.restCursorPos(n.target.chatInput.vnode,n.target.chatInput.cursorIndex),n.target.chatInput.viewIntoPoint();case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();u.dialogElm.onclick=h;var p=u.dialogElm.querySelector(".call-user-popup-main");p.onclick=function(t){t.stopPropagation()},u.dialogShowElm=u.dialogElm.querySelector(".popup-show"),u.dialogShowElm.onclick=h,u.dialogCheckElm=u.dialogElm.querySelector(".popup-check"),u.dialogCheckElm.onclick=i(e().mark((function i(){var a,o,s;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u.dialogCheckElm.classList.contains("disabled")){e.next=2;break}return e.abrupt("return");case 2:if(0!==(a=u.dialogElm.querySelectorAll(".user-popup-check-item-check")||[]).length){e.next=7;break}return e.next=6,h();case 6:case 12:return e.abrupt("return");case 7:if(!Array.prototype.some.call(a,(function(t){return"isALL"===t.getAttribute("data-set-id")}))){e.next=13;break}return e.next=10,n.target.onceSetTag(t(t({},r.userProps.id,"isALL"),r.userProps.name,r.dialogLabels.h5Dialog.callEveryLabel));case 10:return e.next=12,h();case 13:return o=Array.from(a,(function(t){return t.getAttribute("data-set-id")})),s=r.userList.filter((function(t){return-1!==o.indexOf(String(t[r.userProps.id]))})),e.next=16,n.target.batchSetTag(s);case 16:return e.next=18,h();case 18:case"end":return e.stop()}}),i)}))),u.dialogMainElm=u.dialogElm.querySelector(".call-user-popup-body"),u.dialogEmptyElm=document.createElement("div"),d(u.dialogEmptyElm,"call-user-popup-empty",!0),this.h5Elms.dialogEmptyElm.innerHTML="\n            ".concat('<svg class="empty-svg" viewBox="0 0 64 41" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 1)" fill="none" fill-rule="evenodd"><ellipse fill="#f5f5f5" cx="32" cy="33" rx="32" ry="7"></ellipse><g fill-rule="nonzero" stroke="#d9d9d9"><path d="M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"></path><path d="M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z" fill="#fafafa"></path></g></g></svg>','\n            <span class="empty-label">').concat(r.dialogLabels.h5Dialog.searchEmptyLabel,"</span>\n        "),l(u.dialogEmptyElm),p.appendChild(u.dialogEmptyElm),r.asyncMatch&&(u.dialogLoadingElm=document.createElement("div"),d(u.dialogLoadingElm,"call-user-popup-loading",!0),u.dialogLoadingElm.innerHTML=F,l(u.dialogLoadingElm),p.appendChild(u.dialogLoadingElm)),u.dialogSearchElm=u.dialogElm.querySelector(".call-user-popup-search-input"),u.dialogSearchElm.oninput=C((function(t){var e=String(t.target.value||"").replace(/'/g,"").trim();if(r.asyncMatch){o.matchKey++;var i=o.matchKey;n.target.updateUserList([]),l(u.dialogLoadingElm,!0),l(u.dialogEmptyElm);var a=o.triggerChatEvent("atMatch",e).find((function(t){return t&&t instanceof Promise}));a&&a.then((function(t){if(i===o.matchKey){if(l(u.dialogLoadingElm),!t||t.length<=0)return void l(u.dialogEmptyElm,!0,"flex");n.target.updateUserList(t)}}))}else{var s=[];Array.from(n.h5Elms.dialogMainElm.children,(function(t){if(!e)return l(t,!0,"flex"),void s.push(t);var n=t.getAttribute("data-set-name")||"",i=t.getAttribute("data-set-pinyin")||"";T(n,i,e)?(l(t,!0,"flex"),s.push(t)):l(t)})),l(n.h5Elms.dialogEmptyElm,!s.length,"flex")}}),200),l(u.dialogElm),document.body.appendChild(u.dialogElm)}}},{key:"updatePCUser",value:function(){var t=this,e=this.pcElms,n=this.target;e.pointDialogMainElm.innerHTML="",e.pointDialogActiveElm=void 0;var i=document.createDocumentFragment();if(this.target.options.needCallEvery){var a=document.createElement("div");d(a,"call-user-dialog-item",!0),a.setAttribute("data-set-id","isALL"),this.userSelectStyleAndEvent(a,{id:"isALL",name:n.options.dialogLabels.pcPointDialog.callEveryLabel}),a.innerHTML='\n                <span class="call-user-dialog-item-sculpture">\n                  <span style="transform: scale(0.75)">@</span>\n                </span>\n                <span class="call-user-dialog-item-name">'.concat(n.options.dialogLabels.pcPointDialog.callEveryLabel,"(").concat(n.options.reformList.length,")</span>\n            "),i.appendChild(a)}if(n.options.reformList.forEach((function(e){var n=document.createElement("div");d(n,"call-user-dialog-item",!0),n.setAttribute("data-set-id",e.id),t.userSelectStyleAndEvent(n,e),t.getUserHtmlTemplate(n,e),i.appendChild(n)})),e.pointDialogMainElm.appendChild(i),e.pointDialogUsersElm=[],Array.from(e.pointDialogMainElm.children||[],(function(t,n){e.pointDialogUsersElm.push({index:n,elm:t})})),!n.options.asyncMatch){e.checkDialogUsersElm.innerHTML='\n            <div class="checkbox-dialog-check-item" data-set-value="ALL">\n                <input type="checkbox" value>\n                <span class="checkbox-dialog-check-item-inner"></span>\n                <div class="checkbox-dialog-check-item-label">'.concat(n.options.dialogLabels.pcPCheckDialog.checkAllLabel,"</div>\n            </div>\n        ");var r=document.createDocumentFragment();n.options.reformList.forEach((function(e){var n=document.createElement("div");d(n,"checkbox-dialog-check-item",!0),n.setAttribute("data-set-value",e.id),n.innerHTML='\n                <input type="checkbox" value>\n                <span class="checkbox-dialog-check-item-inner"></span>\n            ',t.getUserHtmlTemplate(n,e),r.appendChild(n)})),e.checkDialogUsersElm.appendChild(r),e.checkDialogUsersElm&&e.checkDialogUsersElm.children.length&&Array.from(e.checkDialogUsersElm.children,(function(e){e.onclick=function(){var i=e.getAttribute("data-set-value")||"",a=n.options.reformList.find((function(t){return t.id===i})),r=-1===e.className.indexOf("checkbox-dialog-check-item-check");"ALL"===i?t.checkboxRows=r?n.options.reformList.map((function(t){return t})):[]:r?t.checkboxRows.push(a):t.checkboxRows=t.checkboxRows.filter((function(t){return t.id!==i})),t.updateCheckDialogTags()}}));var o=document.createDocumentFragment();n.options.reformList.forEach((function(e){var i=document.createElement("div");d(i,"checkbox-dialog-check-item",!0),i.setAttribute("data-set-id",e.id);var a=document.createElement("div");d(a,"checkbox-dialog-check-item-label",!0),t.getUserHtmlTemplate(a,e),i.appendChild(a),i.onclick=function(){l(t.pcElms.checkDialogSearchResultElm);var e=i.getAttribute("data-set-id")||"";if(t.pcElms.checkDialogSearchInputElm.value="",t.pcElms.checkDialogSearchInputElm.focus(),!t.checkboxRows.some((function(t){return t.id===e}))){var a=n.options.reformList.find((function(t){return t.id===e}));a&&t.checkboxRows.push(a),t.updateCheckDialogTags()}},o.appendChild(i)}));var s=document.createElement("div");d(s,"checkbox-dialog-search-empty",!0),s.innerText=n.options.dialogLabels.pcPCheckDialog.searchEmptyLabel,o.appendChild(s),e.checkDialogSearchResultElm.appendChild(o)}}},{key:"updateH5User",value:function(){var t=this,e=this.h5Elms,n=this.target;e.dialogMainElm.innerHTML="";var i=n.options.reformList&&n.options.reformList.length>0,a=document.createDocumentFragment(),r=document.createElement("span");if(r.innerHTML='\n            <input type="checkbox" value>\n            <span class="user-popup-check-item-inner"></span>\n        ',i){var o=document.createElement("div");n.options.needCallEvery&&(d(o,"call-user-popup-item",!0),o.setAttribute("data-set-id","isALL"),o.innerHTML='\n                    <span class="call-user-dialog-item-sculpture">\n                        <span style="transform: scale(0.75)">@</span>\n                    </span>\n                    <span class="call-user-dialog-item-name">'.concat(n.options.dialogLabels.h5Dialog.callEveryLabel,"(").concat(n.options.reformList.length,")</span>\n                "),o.appendChild(r.cloneNode(!0)),o.onclick=function(){var e=!o.classList.contains("user-popup-check-item-check");Array.from(t.h5Elms.dialogMainElm.children,(function(t){d(t,"user-popup-check-item-check",e)})),d(t.h5Elms.dialogCheckElm,"disabled",!e)},a.appendChild(o)),n.options.reformList.forEach((function(e,n){var i=document.createElement("div");d(i,"call-user-popup-item",!0),i.setAttribute("data-set-id",e.id),i.setAttribute("data-set-name",e.name),i.setAttribute("data-set-pinyin",e.pinyin||""),t.getUserHtmlTemplate(i,e),i.appendChild(r.cloneNode(!0)),a.appendChild(i),i.onclick=function(e){var n=!i.classList.contains("user-popup-check-item-check");d(i,"user-popup-check-item-check",n);var a=Array.prototype.every.call(t.h5Elms.dialogMainElm.children,(function(t){return t.classList.contains("user-popup-check-item-check")||"isALL"===t.getAttribute("data-set-id")}));d(o,"user-popup-check-item-check",a);var r=Array.prototype.some.call(t.h5Elms.dialogMainElm.children,(function(t){return t.classList.contains("user-popup-check-item-check")}));d(t.h5Elms.dialogCheckElm,"disabled",!r)}}))}e.dialogMainElm.appendChild(a)}},{key:"updateCheckDialogTags",value:function(){var t=this,e=this.checkboxRows.map((function(t){return t.id})),n=[],i=[],a=document.createElement("div");a.className="check-empty",a.innerHTML="\n            ".concat('<svg class="check-empty-svg" viewBox="0 0 64 41" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 1)" fill="none" fill-rule="evenodd"><ellipse fill="#f5f5f5" cx="32" cy="33" rx="32" ry="7"></ellipse><g fill-rule="nonzero" stroke="#d9d9d9"><path d="M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"></path><path d="M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z" fill="#fafafa"></path></g></g></svg>','\n            <span class="check-empty-label">').concat(this.target.options.dialogLabels.pcPCheckDialog.checkEmptyLabel,"</span>\n        "),Array.from(this.pcElms.checkDialogTagsElm.children,(function(t){var a=t.getAttribute("data-set-value");-1===e.indexOf(a)?i.push(t):n.push(a)})),Array.from(this.pcElms.checkDialogUsersElm.children,(function(n,i){if(0!==i){var a=n.getAttribute("data-set-value");d(n,"checkbox-dialog-check-item-check",-1!==e.indexOf(a))}else d(n,"checkbox-dialog-check-item-check",e.length===t.target.options.reformList.length)})),i.forEach((function(e){t.pcElms.checkDialogTagsElm.removeChild(e)})),d(this.pcElms.checkDialogElm.querySelector(".btn-submit"),"disabled",e.length<=0),e.length||this.pcElms.checkDialogTagsElm.appendChild(a);var r=this.checkboxRows.filter((function(t){return-1===n.indexOf(t.id)}));if(r.length){var o=document.createDocumentFragment();r.forEach((function(e){var n=document.createElement("div");n.setAttribute("class","checkbox-dialog-tag-item"),n.setAttribute("data-set-value",e.id),n.innerHTML="\n        <span>".concat(e.name,"</span>\n      ");var i=document.createElement("span");i.setAttribute("class","checkbox-dialog-tag-item-close"),i.innerHTML="⛌",i.onclick=function(){var e=n.getAttribute("data-set-value");t.checkboxRows=t.checkboxRows.filter((function(t){return t.id!==e})),t.updateCheckDialogTags()},n.appendChild(i),o.appendChild(n)})),this.pcElms.checkDialogTagsElm.appendChild(o)}}},{key:"userSelectStyleAndEvent",value:function(t,n){var a=this;t.addEventListener("click",function(){var r=i(e().mark((function i(r){var o,s;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=a.target.options,r.stopPropagation(),a.updatePointActiveUserElm(t),!a.isPointSearchMode&&!o.asyncMatch){e.next=6;break}return e.next=4,a.target.matchSetTag(n);case 4:e.next=9;break;case 6:return s=o.userList.find((function(t){return String(t[o.userProps.id])===n.id})),e.next=9,a.target.onceSetTag(s);case 9:a.exitPointDialog();case 10:case"end":return e.stop()}}),i)})));return function(t){return r.apply(this,arguments)}}())}},{key:"bindCustomTrigger",value:function(){var t=this;Object.values(this.pcElms.customTagDialogElms).forEach((function(e){t.pcElms.containerDialogElm.removeChild(e)})),this.pcElms.customTagDialogElms={},this.customTags={},this.target.options.customTrigger.forEach((function(e){e.tagList&&e.tagList.length>0&&(t.customTags[e.prefix]=e.tagList.map((function(t){return{id:String(t.id),name:String(t.name),pinyin:String(t.pinyin||"")}})),t.createCustomTagDialog(e))}))}},{key:"createCustomTagDialog",value:function(t){var n=this,a=document.createElement("div");a.setAttribute("class","call-tag-dialog"),l(a);var r=document.createElement("div");r.setAttribute("class","call-tag-dialog-header"),r.innerHTML='<span class="call-tag-dialog-header-title">'.concat(t.dialogTitle||t.prefix,"</span>"),a.appendChild(r);var o=document.createElement("div");o.setAttribute("class","call-tag-dialog-main"),t.tagList.forEach((function(t){var a=document.createElement("div");a.setAttribute("class","call-tag-dialog-item"),a.setAttribute("data-set-id",t.id);var r=document.createElement("span");r.setAttribute("class","call-tag-dialog-item-name"),r.innerHTML=t.name,a.appendChild(r),a.addEventListener("click",function(){var r=i(e().mark((function i(r){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.stopPropagation(),n.updateActiveCustomTagElm(a),!n.isPointSearchMode){e.next=7;break}return e.next=5,n.target.matchSetCustomTag(t);case 5:e.next=9;break;case 7:return e.next=9,n.target.onceSetCustomTag(t);case 9:n.exitCustomTagDialog();case 10:case"end":return e.stop()}}),i)})));return function(t){return r.apply(this,arguments)}}()),o.appendChild(a)})),a.appendChild(o),this.pcElms.containerDialogElm.appendChild(a),this.pcElms.customTagDialogElms[t.prefix]=a}},{key:"getUserHtmlTemplate",value:function(t,e){var n=document.createElement("span");if(n.setAttribute("class","call-user-dialog-item-sculpture ".concat(e.avatar?"is-avatar":"")),e.avatar){var i=new Image;i.alt="",i.src=String(e.avatar),n.appendChild(i)}else n.innerHTML='<span style="transform: scale(0.75)">'.concat(e.name.slice(-2),"</span>");t.appendChild(n);var a=document.createElement("span");a.setAttribute("class","call-user-dialog-item-name"),a.innerHTML=e.name,t.appendChild(a)}},{key:"updatePointActiveUserElm",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pcElms.pointDialogActiveElm&&d(this.pcElms.pointDialogActiveElm,"call-user-dialog-item-active"),this.pcElms.pointDialogActiveElm=t,t&&(d(t,"call-user-dialog-item-active",!0),e)){var n=Array.prototype.filter.call(this.pcElms.pointDialogMainElm.children,(function(t){return-1===t.className.indexOf("user-no-match")})),i=t.clientHeight,a=Array.prototype.indexOf.call(n,t)+1-Math.ceil(Math.floor(this.pcElms.pointDialogMainElm.clientHeight/i)/2);this.pcElms.pointDialogMainElm.scrollTop=a>0?a*i:0}}},{key:"updateActiveCustomTagElm",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pcElms.customTagDialogActiveElm&&d(this.pcElms.customTagDialogActiveElm,"call-tag-dialog-item-active"),this.pcElms.customTagDialogActiveElm=t,t&&(d(t,"call-tag-dialog-item-active",!0),e)){var n=this.pcElms.customTagDialogElms[this.pcElms.customTagDialogTagKey].children[1],i=Array.prototype.filter.call(n.children,(function(t){return-1===t.className.indexOf("tag-no-match")})),a=t.clientHeight,r=Array.prototype.indexOf.call(i,t)+1-Math.ceil(Math.floor(n.clientHeight/a)/2);n.scrollTop=r>0?r*a:0}}},{key:"showPointDialog",value:function(t){this.exitSelectDialog(),this.exitCustomTagDialog(),this.exitPointDialog(),this.isPointSearchMode=!!t;var e=null;this.pcElms.pointDialogUsersElm.forEach((function(n){var i=n.elm,a=i.getAttribute("data-set-id"),r=t&&t.every((function(t){return t.id!==a}));!e&&!r&&(e=i),d(i,"user-no-match",r)})),null!==e&&this.updatePointActiveUserElm(e),l(this.pcElms.pointDialogCheckElm,!this.target.options.asyncMatch&&!this.isPointSearchMode),l(this.pcElms.pointDialogElm,!0),this.target.chatEvent.debounceEvents.dialogMoveToRange(this.pcElms.pointDialogElm),this.pcElms.pointDialogMainElm.scrollTop=0}},{key:"showCustomTagDialog",value:function(t,e){this.exitSelectDialog(),this.exitCustomTagDialog(),this.exitPointDialog(),this.isPointSearchMode=!!e,this.pcElms.customTagDialogTagKey=t;var n=this.pcElms.customTagDialogElms[t],i=n.children[1],a=null;Array.from(i.children,(function(t){var n=t.getAttribute("data-set-id"),i=e&&e.every((function(t){return t.id!==n}));!a&&!i&&(a=t),d(t,"tag-no-match",i)})),null!==a&&this.updateActiveCustomTagElm(a),l(n,!0),this.target.chatEvent.debounceEvents.dialogMoveToRange(n),n.children[1].scrollTop=0}},{key:"exitPointDialog",value:function(){this.updatePointActiveUserElm(),this.target.options.asyncMatch&&this.target.updateUserList([]),l(this.pcElms.pointDialogElm)}},{key:"exitCustomTagDialog",value:function(){for(var t in this.updateActiveCustomTagElm(),this.pcElms.customTagDialogElms)l(this.pcElms.customTagDialogElms[t])}},{key:"ruleShowPointDialog",value:function(){var t=this.target,e=t.options,n=t.chatInput;e.needDialog&&e.reformList.length>0&&n.showAt()&&(this.isExternalCallPopup=!1,this.showPointDialog())}},{key:"showPlaceholder",value:function(){l(this.placeholderElm,this.target.isEmpty()),this.offsetTipElm()}},{key:"bindSelectList",value:function(){var t=this;Object.values(this.pcElms.selectDialogElms).forEach((function(e){t.pcElms.containerDialogElm.removeChild(e)})),this.pcElms.selectDialogElms={},this.selectTags={},this.target.options.selectList.forEach((function(e){e.options&&e.options.length>0&&(t.selectTags[e.key]=e.options.map((function(t){return{id:String(t.id),name:String(t.name),preview:String(t.preview||"")}})),t.createSelectDialog(e))}))}},{key:"createSelectDialog",value:function(t){var n=this,a=document.createElement("div");a.setAttribute("class","chat-select-dialog"),l(a);var r=document.createElement("div");r.setAttribute("class","chat-select-dialog-header"),r.innerHTML='<span class="chat-select-dialog-header-title">'.concat(t.dialogTitle||t.key,"</span>"),a.appendChild(r);var o=document.createElement("div");o.setAttribute("class","chat-select-dialog-main"),t.options.forEach((function(t){var a=document.createElement("div");if(a.setAttribute("class","chat-select-dialog-item"),a.setAttribute("data-set-id",t.id),t.preview){var r=document.createElement("img");r.setAttribute("class","chat-select-dialog-preview"),r.src=String(t.preview),a.appendChild(r)}var s=document.createElement("span");s.setAttribute("class","chat-select-dialog-name"),s.textContent=t.name;var c=document.createElement("span");c.setAttribute("class","chat-select-dialog-check"),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M9.218 17.41 19.83 6.796a.99.99 0 1 1 1.389 1.415c-3.545 3.425-4.251 4.105-11.419 11.074a.997.997 0 0 1-1.375.018c-1.924-1.801-3.709-3.568-5.573-5.43a.999.999 0 0 1 1.414-1.413z"></path></svg>',l(c),s.appendChild(c),a.appendChild(s),a.onclick=i(e().mark((function i(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.target.setSelectTag(t);case 2:case"end":return e.stop()}}),i)}))),o.appendChild(a)})),a.appendChild(o);var s=document.createElement("div");s.setAttribute("class","chat-select-arrow"),a.appendChild(s),this.pcElms.containerDialogElm.appendChild(a),this.pcElms.selectDialogElms[t.key]=a}},{key:"exitSelectDialog",value:function(){for(var t in this.pcElms.selectDialogElms)l(this.pcElms.selectDialogElms[t]);this.pcElms.selectDialogKey="",this.pcElms.selectDialogAim&&(d(this.pcElms.selectDialogAim,"aim"),this.pcElms.selectDialogAim=null)}},{key:"createTipElm",value:function(t){var e=this;this.tipElm||(this.tipElm=document.createElement("div")),d(this.tipElm,"chat-tip-wrap",!0),this.tipElm.innerHTML='\n            <div class="chat-tip-tag">\n                <span class="chat-tip-tag-txt">'.concat(t.tagLabel||"--",'</span>\n                <span class="chat-tip-tag-close">\n                    ').concat('<svg focusable="false" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true" fill-rule="evenodd" viewBox="64 64 896 896"><path d="M512 64c247.4 0 448 200.6 448 448S759.4 960 512 960 64 759.4 64 512 264.6 64 512 64zm127.98 274.82h-.04l-.08.06L512 466.75 384.14 338.88c-.04-.05-.06-.06-.08-.06a.12.12 0 00-.07 0c-.03 0-.05.01-.09.05l-45.02 45.02a.2.2 0 00-.05.09.12.12 0 000 .07v.02a.27.27 0 00.06.06L466.75 512 338.88 639.86c-.05.04-.06.06-.06.08a.12.12 0 000 .07c0 .03.01.05.05.09l45.02 45.02a.2.2 0 00.09.05.12.12 0 00.07 0c.02 0 .04-.01.08-.05L512 557.25l127.86 127.87c.04.04.06.05.08.05a.12.12 0 00.07 0c.03 0 .05-.01.09-.05l45.02-45.02a.2.2 0 00.05-.09.12.12 0 000-.07v-.02a.27.27 0 00-.05-.06L557.25 512l127.87-127.86c.04-.04.05-.06.05-.08a.12.12 0 000-.07c0-.03-.01-.05-.05-.09l-45.02-45.02a.2.2 0 00-.09-.05.12.12 0 00-.07 0z"></path></svg>',"\n                </span>\n            </div>\n        "),this.target.options.elm.appendChild(this.tipElm);var n=this.tipElm.children[0],i=(n.clientHeight-this.target.chatInput.NODE_HEIGHT)/2;this.tipElm.style.top="-".concat(i,"px"),n.onclick=function(){e.target.closeTipTag()},n.onmouseenter=function(){if(e.pcElms.tipPopoverElm){l(e.pcElms.tipPopoverElm,!0);var t=e.pcElms.containerDialogElm.getBoundingClientRect();e.rects.tipRect=e.tipElm.getBoundingClientRect();var i=(e.pcElms.tipPopoverElm.clientWidth-(e.tipElm.clientWidth+(e.tipElm.clientWidth-n.clientWidth)))/2;e.pcElms.tipPopoverElm.style.left=-i+"px",e.pcElms.tipPopoverElm.style.bottom=t.y-e.rects.tipRect.y+"px",e.pcElms.tipPopoverElm.style.transform=n.style.transform}},n.onmouseleave=function(){e.pcElms.tipPopoverElm&&l(e.pcElms.tipPopoverElm)};var a=this.richText.children[0].children[0];this.rects.tipRect=this.tipElm.getBoundingClientRect();var r=this.rects.tipRect;this.placeholderElm.style.paddingLeft=r.width+"px",a.style.paddingLeft=r.width-a.offsetLeft+"px",this.offsetTipElm(),this.target.deviceInfo.isPc&&(this.pcElms.tipPopoverElm||(this.pcElms.tipPopoverElm=document.createElement("div")),d(this.pcElms.tipPopoverElm,"chat-tip-popover",!0),this.pcElms.tipPopoverElm.innerHTML='\n                <div class="chat-tip-popover-main">\n                    <span class="chat-tip-popover-txt">'.concat(t.popoverLabel||"--",'</span>\n                    <span class="chat-tip-popover-code ').concat(t.codeLabel?"":"chat-view-show",'">').concat(t.codeLabel||"--",'</span>\n                </div>\n                <div class="chat-tip-popover-arrow"></div>\n            '),this.pcElms.containerDialogElm.appendChild(this.pcElms.tipPopoverElm),l(this.pcElms.tipPopoverElm))}},{key:"offsetTipElm",value:function(){var t=this;if(this.tipElm){var e=this.richText.children[0].children[0];e.style.paddingLeft=this.rects.tipRect.width-e.offsetLeft+"px",this.target.nextTick((function(){if(t.tipElm){var e=t.tipElm.children[0],n=t.richText.children[0].children[0];e.style.transform="translateY(".concat(n.offsetTop-t.target.chatInput.NODE_PADDING_DIFF,"px)")}}))}}},{key:"removeTipElm",value:function(){this.tipElm&&(this.target.options.elm.removeChild(this.tipElm),this.tipElm=null),this.pcElms.tipPopoverElm&&(this.pcElms.containerDialogElm.removeChild(this.pcElms.tipPopoverElm),this.pcElms.tipPopoverElm=null);var t=this.richText.children[0].children[0];this.placeholderElm.style.removeProperty("padding-left"),t.style.removeProperty("padding-left"),this.target.chatInput.setRangeLastText()}}])}(),O=function(){return o((function t(e){a(this,t),s(this,"target"),s(this,"richText"),s(this,"vnode"),s(this,"cursorIndex"),s(this,"cursorLeft"),s(this,"needCallSpace",!1),s(this,"VOID_KEY","\ufeff"),s(this,"ZERO_WIDTH_KEY","​"),s(this,"INPUT_TAG_WRAP_KEY","​\n​"),s(this,"NODE_HEIGHT",24),s(this,"NODE_PADDING_DIFF",10),s(this,"IME_RECORD",{MARK:void 0,GRID:void 0,TAG:void 0,NODE:void 0,INDEX:void 0}),this.target=e,this.richText=e.chatElement.richText,this.initEditor()}),[{key:"initEditor",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(e||this.getNodeEmpty(this.richText)){this.richText.innerHTML="";var i=this.getGridElm();this.richText.appendChild(i);var a=i.children[0].children[0];n&&(a.textContent=n,a.setAttribute(p,"false"));var r=a.childNodes[0];e||this.target.options.autoFocus?this.restCursorPos(r,r.textContent===this.VOID_KEY?1:r.textContent.length):(this.vnode=r,this.cursorIndex=r.textContent===this.VOID_KEY?1:r.textContent.length),this.target.nextTick((function(){var e=i.getBoundingClientRect();t.NODE_HEIGHT=e.height,t.NODE_PADDING_DIFF=e.top-t.target.options.elm.getBoundingClientRect().top}))}}},{key:"onceCall",value:function(t){var e=this;return new Promise((function(n){var i=e.createChatTagElm(t,"@","at-user","user-id");e.replaceRegContent(i),n()}))}},{key:"onceSearchCall",value:function(t,e){var n=this;return new Promise((function(i){var a=n.createChatTagElm(t,"@","at-user","user-id");n.replaceRegContent(a,e),i()}))}},{key:"onceCustomCall",value:function(t,e,n){var i=this;return new Promise((function(a){var r=i.createChatTagElm(t,n,"at-tag","tag-id");r.children[0].setAttribute("data-set-prefix",n),i.replaceRegContent(r,e),a()}))}},{key:"upDataNodeOrIndex",value:function(){var t,e,n,i=window.getSelection(),a=i.focusNode,r=i.focusOffset,o=i.anchorOffset,s=(null==a?void 0:a.parentNode)||void 0;!s||!s.getAttribute||s.getAttribute(g)!==v||(null==(n=null==(e=null==(t=null==a?void 0:a.parentNode)?void 0:t.parentNode)?void 0:e.parentNode)?void 0:n.parentNode)!==this.richText||(this.vnode=a,this.cursorIndex=r,this.cursorLeft=o<r?o:r)}},{key:"showAt",value:function(){if(this.upDataNodeOrIndex(),!this.vnode||this.vnode.nodeType!==Node.TEXT_NODE)return!1;var t=(this.vnode.textContent||"").slice(0,this.cursorIndex),e=/@([^@\s]*)$/.exec(t);return e&&2===e.length&&"@"===t[t.length-1]}},{key:"getRangeRect",value:function(){var t=0,e=0,n=window.getSelection();if(n.focusNode.nodeType!==Node.TEXT_NODE)return null;var i=n.getRangeAt(0).getClientRects()[0];return i&&(t=i.x,e=i.y),{x:t,y:e}}},{key:"createChatTagElm",value:function(t,e,n,i){var a=document.createElement("span");return a.className=n,a.setAttribute("data-".concat(i),String(t.id)),a.textContent="".concat(e).concat(t.name).concat(this.needCallSpace?" ":""),this.createNewDom(a)}},{key:"createNewDom",value:function(t){var e=document.createElement("span");return e.className="chat-tag",e.setAttribute("contenteditable","false"),e.setAttribute(g,x),e.appendChild(t),e}},{key:"restCursorPos",value:function(t,e){null==e?e=t.textContent===this.VOID_KEY?1:0:e>t.textContent.length&&(e=t.textContent.length);var n=new Range;n.setStart(t,e),n.setEnd(t,e);var i=window.getSelection();i&&(this.vnode=t,this.cursorIndex=e,this.cursorLeft=e,i.removeAllRanges(),i.addRange(n))}},{key:"replaceRegContent",value:function(t){var e,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.vnode.textContent;0===(e="boolean"==typeof n?i.slice(0,n?this.cursorIndex-1:this.cursorIndex):i.slice(0,n-1)).length?(this.vnode.parentElement.setAttribute(p,"true"),this.vnode.textContent=this.VOID_KEY):this.vnode.textContent=e;var a=i.slice(this.cursorIndex),r=this.vnode.parentNode.parentNode,o=r.nextSibling;o?r.parentNode.insertBefore(t,o):r.parentNode.appendChild(t);var s=t.previousSibling.childNodes[0],c=s.childNodes[1];c&&s.removeChild(c);var l=this.getGridElm(!0),u=l.childNodes[0];a&&a!==this.VOID_KEY&&(u.setAttribute(p,"false"),u.innerHTML=a);var h=u.childNodes[1];t.nextSibling?(h&&u.removeChild(h),r.parentNode.insertBefore(l,t.nextSibling)):r.parentNode.appendChild(l),this.restCursorPos(u.childNodes[0])}},{key:"batchReplaceRegContent",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise((function(i){var a="<span ".concat(g,'="').concat(E,'"><span class="chat-grid-input" ').concat(g,'="').concat(v,'" ').concat(p,'="true">').concat(t.VOID_KEY,"</span></span>");e.forEach((function(e){a+='<span class="chat-tag" contenteditable="false" '.concat(g,'="').concat(x,'"><span class="at-user" data-user-id="').concat(e.id,'" contentEditable="false">@').concat(e.name).concat(t.needCallSpace?" ":"","</span></span><span ").concat(g,'="').concat(E,'"><span class="chat-grid-input" ').concat(g,'="').concat(v,'" ').concat(p,'="true">').concat(t.VOID_KEY,"</span></span>")}));var r=document.createElement("div");r.innerHTML=a,t.insetRangeGrid(r,n?1:0),i()}))}},{key:"switchRange",value:function(t){var e,n,i=window.getSelection(),a=i.focusNode,r=i.focusOffset;a.getAttribute&&a.getAttribute(g)===v&&(a=a.childNodes[0]);var o,s,c=!1;if(a.nodeType===Node.TEXT_NODE){var l=a.textContent.length,u=a.parentNode.parentNode;switch(t){case"ArrowLeft":if(r>0&&a.textContent!==this.VOID_KEY){s=r-1,o=a;break}var h=u.previousSibling;if(h&&h.children[0].classList.contains("at-input")){s=(o=h.children[0].children[0].childNodes[0]).textContent===this.VOID_KEY?1:o.textContent.length,c=!0;break}var d=null==(e=null==u?void 0:u.previousSibling)?void 0:e.previousSibling;if(d)s=(o=d.childNodes[0].childNodes[0]).textContent.length;else{var p=u.parentNode.previousSibling;p&&(s=(o=p.lastChild.childNodes[0].childNodes[0]).textContent.length)}break;case"ArrowRight":if(r<l&&a.textContent!==this.VOID_KEY){s=r+1,o=a;break}var m=u.nextSibling;if(m&&m.children[0].classList.contains("at-input")){s=(o=m.children[0].children[0].childNodes[0]).textContent===this.VOID_KEY?1:0,c=!0;break}var f=null==(n=null==u?void 0:u.nextSibling)?void 0:n.nextSibling;if(f)s=(o=f.childNodes[0].childNodes[0]).textContent===this.VOID_KEY?1:0;else{var E=u.parentNode.nextSibling;E&&(s=(o=E.childNodes[0].childNodes[0].childNodes[0]).textContent===this.VOID_KEY?1:0)}}}(s||0===s)&&(c?this.setInputTagRange(o,s):this.restCursorPos(o,s))}},{key:"getGridElm",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=document.createElement("span");if(e.setAttribute(g,E),e.innerHTML='<span class="chat-grid-input" '.concat(g,'="').concat(v,'" ').concat(p,'="true">').concat(this.VOID_KEY,"<br></span>"),t)return e;var n=document.createElement("p");return n.className="chat-grid-wrap",n.setAttribute(g,f),n.appendChild(e),n}},{key:"updateGrid",value:function(){var t=window.getSelection(),e=t.focusNode;if(e){var n,i,a,r,o=e.parentNode;switch(o.getAttribute(g)){case m:if(!(n=e.childNodes[t.focusOffset])||n.getAttribute(g)===x){var s=this.getGridElm(!0),c=s.children[0];n?(c.removeChild(c.childNodes[1]),e.insertBefore(s,n)):e.appendChild(s),this.restCursorPos(c.childNodes[0]);break}if(n.tagName&&"BR"===n.tagName.toLocaleUpperCase()){var l=this.getGridElm(!0),u=l.children[0];e.insertBefore(l,n),e.removeChild(n),this.restCursorPos(u.childNodes[0],u.childNodes[0].textContent.length)}break;case E:var h=o.parentNode,d=Array.prototype.indexOf.call(h.childNodes,o);if(-1===d)break;if(0===d){var f=t.focusNode;f.setAttribute(p,"true"),f.innerHTML="".concat(this.VOID_KEY,"<br>"),n=f.childNodes[0],this.restCursorPos(n,n.textContent.length);break}var D,y=o.previousSibling;y.getAttribute(g)===x?(D=y.previousSibling,h.removeChild(y),h.removeChild(o)):(D=o.previousSibling,h.removeChild(o)),(n=D.childNodes[0].childNodes[0]).textContent===this.VOID_KEY&&n.parentNode.appendChild(document.createElement("br")),this.restCursorPos(n,n.textContent.length);break;case v:if(a=(r=o.parentNode).parentNode,this.getNodeEmpty(o)){o.setAttribute(p,"true"),a.childNodes[a.childNodes.length-1]===r&&(o.innerHTML="".concat(this.VOID_KEY,"<br>")),n=o.childNodes[0],this.restCursorPos(n,n.textContent.length);break}if("true"===String(o.getAttribute(p))){o.setAttribute(p,"false"),n=o.childNodes[0],this.target.chatEvent.isIMEModel?(o.childNodes[1]&&o.removeChild(o.childNodes[1]),n.textContent===this.VOID_KEY&&o.setAttribute(p,"true")):o.textContent=n.textContent.replace(new RegExp(this.VOID_KEY,"g"),"");var C=o.childNodes[0];this.restCursorPos(C,C.textContent.length)}if((i=o.parentNode.nextSibling)&&i.nodeType===Node.TEXT_NODE){var b=i.textContent,T=this.getGridElm(!0);T.childNodes[0].textContent=b,T.childNodes[0].setAttribute(p,"false"),i.parentNode.insertBefore(T,i),i.parentNode.removeChild(i),i=T}i&&i.getAttribute(g)===E&&this.markMerge(o.parentNode,i)}}}},{key:"getNodeEmpty",value:function(t){var e=new RegExp("^(".concat(this.ZERO_WIDTH_KEY,"|<br>|").concat(this.VOID_KEY,")+$"));return!t.innerHTML||e.test(t.innerHTML)}},{key:"setWrap",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=window.getSelection(),n=e.focusNode,i=e.focusOffset;if(n.nodeType!==Node.TEXT_NODE){if(!n.getAttribute||n.getAttribute(g)!==v)return;n=n.childNodes[0]}var a=n.textContent.slice(i),r=n.parentNode.parentNode,o=r.parentNode,s=Array.prototype.indexOf.call(o.childNodes,r),c=Array.prototype.slice.call(o.childNodes,s+1),l=this.getGridElm(),u=l.children[0].children[0].childNodes[0];(a||c.length>0)&&u.parentNode.removeChild(u.parentNode.childNodes[1]),a&&a!==this.VOID_KEY&&(n.textContent=n.textContent.slice(0,i),u.textContent=a,u.parentElement.setAttribute(p,"false")),c.forEach((function(t){o.removeChild(t),l.appendChild(t)}));var h=o.lastChild.childNodes[0],d=l.lastChild.childNodes[0];if(h.childNodes.length<=1){var m=h.childNodes[0];(!m.textContent||m.textContent===this.VOID_KEY)&&(h.innerHTML="".concat(this.VOID_KEY,"<br>"),h.setAttribute(p,"true"))}if(d.parentElement.getAttribute(g)!==E)l.appendChild(this.getGridElm(!0));else if(d.childNodes.length<=1){var f=d.childNodes[0];(!f.textContent||f.textContent===this.VOID_KEY)&&(d.innerHTML="".concat(this.VOID_KEY,"<br>"),d.setAttribute(p,"true"),u=l.children[0].children[0].childNodes[0])}o.nextSibling?this.richText.insertBefore(l,o.nextSibling):this.richText.appendChild(l),t&&this.restCursorPos(u,u.textContent===this.VOID_KEY?1:0)}},{key:"selectRegionMerge",value:function(){var t=window.getSelection();if(!(t.isCollapsed||t.rangeCount<=0)){var e=t.getRangeAt(0);if(e.startContainer.nodeType===Node.TEXT_NODE&&e.startContainer===e.endContainer){var n=e.startContainer;if(n.length===e.endOffset-e.startOffset){var i=n.parentNode,a=i.parentNode===i.parentNode.parentNode.lastChild;i.setAttribute(p,"true"),i.innerHTML="\ufeff".concat(a?"<br>":""),this.restCursorPos(i.childNodes[0])}else e.deleteContents()}else if(e.commonAncestorContainer&&e.commonAncestorContainer.getAttribute(g)===f){var r=e.startContainer.nodeType===Node.TEXT_NODE?e.startContainer.parentNode.parentNode:e.startContainer,o=e.endContainer.nodeType===Node.TEXT_NODE?e.endContainer.parentNode.parentNode:e.endContainer;e.deleteContents(),r.getAttribute(g)===o.getAttribute(g)&&this.markMerge(r,o)}else if(e.commonAncestorContainer===e.startContainer&&e.startContainer===e.endContainer)this.initEditor(!0);else{var s=function(t){if(t.nodeType===Node.TEXT_NODE)return t.parentNode.parentNode.parentNode;switch(t.getAttribute(g)){case v:return t.parentNode.parentNode;case E:return t.parentNode;case f:return t;default:return null}},c=s(e.startContainer),l=s(e.endContainer);if(!c||!l)return;e.deleteContents(),this.gridMerge(c,l)}return!0}}},{key:"gridElmMerge",value:function(){var t=this,e=window.getSelection(),n=e.focusNode,i=e.focusOffset,a=e.isCollapsed;if(!n)return this.restCursorPos(this.vnode,this.cursorIndex),!1;if(i>1||!a)return!1;var r=function(e,n){return(e.parentNode===t.richText||e===e.parentNode.childNodes[0])&&(-1!==Array.prototype.indexOf.call(t.richText.childNodes,e)?e:!(n>=6)&&r(e.parentNode,n+1))},o=r(n,0);if(!o||o===this.richText.childNodes[0]||1===i&&"false"===o.children[0].children[0].getAttribute(p))return!1;var s=o.previousSibling;return this.gridMerge(s,o),!0}},{key:"delMarkRule",value:function(){var t=window.getSelection(),e=t.focusNode;if(!e)return this.restCursorPos(this.vnode,this.cursorIndex),!1;var n=e.textContent,i=e.parentNode,a=i.parentNode,r=a.parentNode;if(!t.isCollapsed||i.getAttribute(g)!==v)return!1;if(n&&1===n.length&&a!==r.childNodes[0]&&(0!==t.focusOffset||n===this.VOID_KEY)){if(n===this.VOID_KEY){var o=a.previousSibling;if(o.children[0].classList.contains("at-input")&&o.children[0].children[0].textContent!==this.VOID_KEY)return this.rangeToInputTag(o.children[0]),!0;var s=o.previousSibling;r.removeChild(o),r.removeChild(a);var c=s.childNodes[0],l=c.childNodes[0];l.textContent===this.VOID_KEY&&s===r.lastChild&&c.appendChild(document.createElement("br")),this.restCursorPos(l,l.textContent.length)}else{i.innerHTML=a===r.lastChild?"".concat(this.VOID_KEY,"<br>"):this.VOID_KEY,i.setAttribute(p,"true");var u=i.childNodes[0];this.restCursorPos(u,1)}return!0}if(0===t.focusOffset){var h=i.parentNode,d=null==h?void 0:h.previousSibling;return!(!d||d.getAttribute(g)!==x)&&(d.children[0].classList.contains("at-input")&&d.children[0].children[0].textContent!==this.VOID_KEY?(this.rangeToInputTag(d.children[0]),!0):(this.delTag(d),!0))}}},{key:"delTag",value:function(t){var e=t.previousSibling,n=t.nextSibling;t.parentNode.removeChild(t),this.markMerge(e,n)}},{key:"gridMerge",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.lastChild.getAttribute(g)!==E&&t.appendChild(this.getGridElm(!0)),e.childNodes[0].getAttribute(g)!==E&&e.insertBefore(this.getGridElm(!0),e.childNodes[0]);var i=t.lastChild.childNodes[0],a=i.childNodes[0],r=a.textContent.length;Array.from(e.childNodes,(function(e){t.appendChild(e.cloneNode(!0))})),e.childNodes.length>1&&i.childNodes[1]&&i.removeChild(i.childNodes[1]);var o=i.parentNode.nextSibling;if(o){var s=o.children[0].childNodes[0];s&&s.textContent!==this.VOID_KEY&&(i.childNodes[1]&&i.removeChild(i.childNodes[1]),a.textContent=(a.textContent+s.textContent).replace(new RegExp(this.VOID_KEY,"g"),(function(){return r--,""})),a.parentElement.setAttribute(p,"false")),t.removeChild(o)}""===a.textContent&&(a.textContent=this.VOID_KEY,a.parentNode.setAttribute(p,"true"),r=1),this.richText.removeChild(e),n&&this.restCursorPos(a,r)}},{key:"markMerge",value:function(t,e){var n=t.children[0].childNodes[0],i=n.textContent.length;if(e){var a=e.children[0].childNodes[0];a&&a.textContent!==this.VOID_KEY&&(n.textContent=(n.textContent+a.textContent).replace(new RegExp(this.VOID_KEY,"g"),(function(){return i--,""})),n.parentElement.setAttribute(p,"false")),e.parentNode.removeChild(e)}""===n.textContent&&(n.textContent=this.VOID_KEY,n.parentNode.setAttribute(p,"true"),i=1);var r=t.parentNode;n.textContent===this.VOID_KEY&&t===r.lastChild&&(n.parentNode.appendChild(document.createElement("br")),n.parentNode.setAttribute(p,"true"),i=1),this.restCursorPos(n,i)}},{key:"setCallSpace",value:function(t){this.needCallSpace=t}},{key:"getWrapNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.nodeType===Node.TEXT_NODE)return t.parentNode.parentNode.parentNode;var n=t.getAttribute(g);if(e&&n===x)return t.parentNode;switch(n){case v:return t.parentNode.parentNode;case E:return t.parentNode;case f:return t}}},{key:"getMarkNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.nodeType===Node.TEXT_NODE)return t.parentNode?t.parentNode.parentNode:null;var n=t.getAttribute(g);if(e&&n===x)return t;switch(n){case v:return t.parentNode;case E:return t}}},{key:"getRichTextNodeIndex",value:function(t){var e=this.getMarkNode(t),n=e?e.parentNode:null;return e&&n?{gridIndex:Array.prototype.indexOf.call(this.richText.childNodes,n),markIndex:Array.prototype.indexOf.call(n.childNodes,e)}:{gridIndex:null,markIndex:null}}},{key:"setWrapNodeByMark",value:function(t){var e=document.createElement("p");return e.className="chat-grid-wrap",e.setAttribute(g,f),Array.from(t,(function(t){e.appendChild(t)})),e}},{key:"setRangeLastText",value:function(){var t=this.richText.childNodes[this.richText.childNodes.length-1],e=t.childNodes[t.childNodes.length-1].children[0].childNodes[0];this.restCursorPos(e,e.textContent===this.VOID_KEY?1:e.textContent.length),this.viewIntoPoint()}},{key:"viewIntoPoint",value:function(){var t,e,n=window.getSelection(),i=n.focusNode,a=n.focusOffset;if(i&&i.parentElement&&i.parentElement.classList.contains("input-write"))t=i.parentElement.parentElement,e=a;else{if(!this.vnode)return;t=this.getMarkNode(this.vnode),e=this.cursorIndex}if(t){var r=t.getBoundingClientRect(),o=Math.ceil(r.height/this.NODE_HEIGHT),s=Math.floor(t.textContent.length/o)||1,c=(Math.floor(e/s)||1)*this.NODE_HEIGHT,l=r.top+(c-this.NODE_HEIGHT),u=this.richText.parentElement,h=u.getBoundingClientRect(),d=h.top,p=h.top+h.height;if(l<d+this.NODE_PADDING_DIFF){var g=d-l;u.scrollTo(0,u.scrollTop-g)}else if(l>p-this.NODE_HEIGHT){var m=l-p+this.NODE_HEIGHT;u.scrollTo(0,u.scrollTop+m)}}}},{key:"insetRangeGrid",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.vnode.textContent,i=n.slice(0,this.cursorIndex-e);0===i.length?(this.vnode.parentElement.setAttribute(p,"true"),this.vnode.textContent=this.VOID_KEY):this.vnode.textContent=i;var a=n.slice(this.cursorIndex),r=[],o=document.createDocumentFragment();Array.from(t.children).forEach((function(t,e){r.push(t),0!==e&&o.appendChild(t)}));var s=r[r.length-1].children[0];a&&a.length>0&&a!==this.VOID_KEY?(s.setAttribute(p,"false"),s.innerHTML=s.textContent+a):s.setAttribute(p,"true");var c=this.getMarkNode(this.vnode),l=c.parentElement,u=c.children[0],h=r[0].textContent;h&&h.length>0&&h!==this.VOID_KEY&&(u.setAttribute(p,"false"),u.innerHTML=(u.textContent+h).replace(new RegExp(this.VOID_KEY,"g"),"")),u.childNodes[1]&&u.removeChild(u.childNodes[1]),c.nextElementSibling?(s.childNodes[1]&&s.removeChild(s.childNodes[1]),l.insertBefore(o,c.nextElementSibling)):l.appendChild(o);var d=a&&a!==this.VOID_KEY?a.length:0;if(r.length>1){var g=s.childNodes[0];this.restCursorPos(g,g.textContent===this.VOID_KEY?1:g.textContent.length-d)}else{var m=u.childNodes[0];this.restCursorPos(m,m.textContent===this.VOID_KEY?1:m.textContent.length-d)}}},{key:"insetRangeGrids",value:function(t){var e=document.createDocumentFragment();Array.from(t).forEach((function(t){e.appendChild(t)}));var n=this.getWrapNode(this.vnode);this.restCursorPos(this.vnode,this.cursorIndex),this.setWrap(!1);var i=n.nextElementSibling;i&&this.richText.insertBefore(e,i),i&&i.previousElementSibling?(this.gridMerge(n,n.nextElementSibling,!1),this.gridMerge(i.previousElementSibling,i,!0)):this.gridMerge(n,n.nextElementSibling,!0)}},{key:"getOffsetRange",value:function(t,e){var n,i,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.children[0].childNodes[0],o=r.textContent;if(0===t)return{rangeNode:r,rangeIndex:a?o.length:o===this.VOID_KEY?1:0};if(o!==this.VOID_KEY&&o.length>=t)return{rangeNode:r,rangeIndex:a?o.length-t:t};if(a?(n=!(!e.previousElementSibling||!e.previousElementSibling.previousElementSibling),i=!!e.parentElement.previousElementSibling):(n=!(!e.nextElementSibling||!e.nextElementSibling.nextElementSibling),i=!!e.parentElement.nextElementSibling),!n&&!i)return{rangeNode:r,rangeIndex:a?o.length===this.VOID_KEY?1:0:o.length===this.VOID_KEY?1:o.length};var s=t-o.length,c=a?n?e.previousElementSibling.previousElementSibling:e.parentElement.previousElementSibling.lastElementChild:n?e.nextElementSibling.nextElementSibling:e.parentElement.nextElementSibling.children[0];return this.getOffsetRange(s,c,a)}},{key:"rangeToInputTag",value:function(t){var e=t.children[0].childNodes[0];this.setInputTagRange(e,e.textContent===this.VOID_KEY?1:e.textContent.length)}},{key:"watchInputTag",value:function(t){var e=this;if(0===t.childNodes.length||0===t.textContent.length)t.textContent=this.VOID_KEY,this.rangeToInputTag(t.parentElement);else{var n=t.childNodes[0];this.target.nextTick((function(){if(!e.target.chatEvent.isComposition){var i=window.getSelection().focusOffset,a=t.textContent===e.VOID_KEY||-1===t.textContent.indexOf(e.VOID_KEY)?0:1,r=!1;1===a&&(n.textContent=n.textContent.replace(e.VOID_KEY,""),r=!0),-1!==t.textContent.indexOf(e.INPUT_TAG_WRAP_KEY[1])&&(t.textContent=t.textContent.replace(new RegExp(e.INPUT_TAG_WRAP_KEY[0],"g"),"").replace(new RegExp(e.INPUT_TAG_WRAP_KEY[1],"g"),e.INPUT_TAG_WRAP_KEY),r=!0),r&&e.setInputTagRange(t.childNodes[0],i-a)}}))}l(t.nextElementSibling,t.textContent===this.VOID_KEY,"inline")}},{key:"backRuleInputTag",value:function(t){if(t.textContent===this.VOID_KEY)return this.delTag(t.parentElement.parentElement),!0;var e=window.getSelection();if(0===e.focusOffset&&e.isCollapsed){var n=t.parentElement.parentElement.previousElementSibling.children[0].childNodes[0];return this.restCursorPos(n,n.textContent===this.VOID_KEY?1:n.textContent.length),!0}if(-1!==e.focusNode.textContent.indexOf(this.INPUT_TAG_WRAP_KEY[1])){var i=this.getDiffInputTagOffset(e.focusNode,e.focusOffset,"left");if(i>0){var a=e.focusNode.textContent.slice(0,e.focusOffset-1-i),r=e.focusNode.textContent.slice(e.focusOffset);return e.focusNode.textContent=a+r,e.focusNode.textContent?this.setInputTagRange(e.focusNode,a.length):(e.focusNode.textContent=this.VOID_KEY,this.watchInputTag(e.focusNode.parentElement),this.setInputTagRange(e.focusNode,1)),!0}}return!1}},{key:"mergeRuleInputTag",value:function(t){var e=this;this.target.nextTick((function(){t.childNodes.length>1&&(t.removeChild(t.childNodes[1]),e.watchInputTag(t))}))}},{key:"inputTagSwitchRange",value:function(t){var e,n,i=window.getSelection(),a=i.focusNode,r=i.focusOffset,o=a.textContent.length,s=a.parentElement.parentElement.parentElement,c=!1;switch(t){case"ArrowLeft":r>0&&a.textContent!==this.VOID_KEY?(n=r-1-this.getDiffInputTagOffset(a,r,"left"),e=a):(n=(e=s.previousElementSibling.children[0].childNodes[0]).textContent===this.VOID_KEY?1:e.textContent.length,c=!0);break;case"ArrowRight":r<o&&a.textContent!==this.VOID_KEY?(n=r+1+this.getDiffInputTagOffset(a,r,"right"),e=a):(n=(e=s.nextElementSibling.children[0].childNodes[0]).textContent===this.VOID_KEY?1:0,c=!0)}c?this.restCursorPos(e,n):this.setInputTagRange(e,n)}},{key:"setInputTagRange",value:function(t,e){var n=new Range;n.setStart(t,e),n.setEnd(t,e);var i=window.getSelection();i&&(i.removeAllRanges(),i.addRange(n))}},{key:"pasteInputTag",value:function(t){t=t.replace(new RegExp(this.INPUT_TAG_WRAP_KEY[0],"g"),"").replace(new RegExp(this.INPUT_TAG_WRAP_KEY[1],"g"),this.INPUT_TAG_WRAP_KEY);var e=window.getSelection(),n=e.focusNode,i=e.focusOffset,a=e.anchorOffset,r="",o="";e.isCollapsed?(r=n.textContent.slice(0,i)||"",o=n.textContent.slice(i)||""):(r=n.textContent.slice(0,a<i?a:i)||"",o=n.textContent.slice(i>a?i:a)||""),n.textContent=r+t+o,this.setInputTagRange(n,(a<i?a:i)+t.length);var s=n.parentElement;this.watchInputTag(s)}},{key:"setInputTagWrap",value:function(t){var e=window.getSelection().focusOffset,n=t.textContent,i=n.slice(0,e),a=n.slice(e);t.textContent=i+this.INPUT_TAG_WRAP_KEY+a,this.setInputTagRange(t.childNodes[0],e+this.INPUT_TAG_WRAP_KEY.length),this.watchInputTag(t)}},{key:"getDiffInputTagOffset",value:function(t,e,n){var i="left"===n?t.textContent[e-1]:t.textContent[e];if(-1===this.INPUT_TAG_WRAP_KEY.indexOf(i))return 0;switch(n){case"left":return t.textContent[e-2]===this.INPUT_TAG_WRAP_KEY[1]?2:t.textContent[e-2]===this.INPUT_TAG_WRAP_KEY[0]?3:1;case"right":return t.textContent[e+1]===this.INPUT_TAG_WRAP_KEY[1]?2:t.textContent[e+1]===this.INPUT_TAG_WRAP_KEY[0]?3:1}}}])}(),M={device:"auto",autoFocus:!0,needDialog:!0,needDebounce:!0,asyncMatch:!1,userList:[],reformList:[],placeholder:"",maxLength:void 0,copyType:["text"],uploadImage:void 0,needCallEvery:!0,needCallSpace:!1,userProps:{},customTrigger:[],dialogLabels:{pcPointDialog:{},pcPCheckDialog:{},h5Dialog:{}},wrapKeyFun:function(t){return t.ctrlKey&&["Enter"].includes(t.key)},sendKeyFun:function(t){return!t.ctrlKey&&["Enter"].includes(t.key)}},R={id:"id",name:"name",avatar:"avatar",pinyin:"pinyin"},_={title:"群成员",callEveryLabel:"所有人",checkLabel:"多选",emptyLabel:"暂无数据"},K={title:"选择要@的人",searchPlaceholder:"搜素人员名称",searchEmptyLabel:"没有匹配到任何结果",userTagTitle:"研讨成员列表",checkAllLabel:"全选",checkEmptyLabel:"请选择需要@的成员",confirmLabel:"确定",cancelLabel:"取消"},H={title:"选择提醒的人",callEveryLabel:"所有人",searchPlaceholder:"搜素人员名称",searchEmptyLabel:"没有匹配到任何结果",confirmLabel:"确定",cancelLabel:"收起"},B={saveTagData:!1,needUserId:!1,needTagId:!1,needSelectId:!1,wrapClassName:void 0,rowClassName:void 0,imgToText:!1,identifyLink:!1},Y=["Backspace","Shift","Tab","CapsLock","Control","Meta","Alt","ContextMenu","Enter","NumpadEnter","Escape","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End","PageUp","PageDown","Insert","Delete","NumLock"],V={"!":"！",$:"￥","(":"（",")":"）","[":"【","]":"】","-":"——",";":"；",":":"：","\\":"、","'":"’",'"':"“","`":"·",",":"，","<":"《",".":"。",">":"》","?":"？"},U=function(){return o((function t(e){a(this,t),s(this,"target"),s(this,"outerApply",!1),s(this,"isComposition",!1),s(this,"matchKey",0),s(this,"startOpenIndex",0),s(this,"textLength",0),s(this,"isIMEModel",!1),s(this,"takeIMEModel",!1),s(this,"undoHistory",[]),s(this,"redoHistory",[]),s(this,"doOverHistory",!0),s(this,"notMergeKey",Y),s(this,"tagProps",V),s(this,"chatEventModule",{enterSend:[],operate:[],defaultAction:[],atMatch:[],atCheck:[],tagCheck:[],selectCheck:[],afterAtCheck:[],afterTagCheck:[],afterSelectCheck:[],showAtDialog:[],showTagDialog:[],showSelectDialog:[],elementClicked:[]}),s(this,"debounceEvents",{recordHistory:function(){},dialogMoveToRange:function(t){},selectDialogToAim:function(){},matchPointDialog:function(){},movePointActiveUserElm:function(t){},moveCustomActiveTagElm:function(t){}}),this.target=e,this.registerEvent(),this.otherEvent()}),[{key:"registerEvent",value:function(){var t=this,n=this.target,a=n.chatElement,r=n.options,o=n.deviceInfo,s=n.chatInput;a.richText.addEventListener("keyup",(function(e){if(!e.target.classList.contains("input-write"))if(e.stopPropagation(),o.isPc)50===e.keyCode||"Digit2"===e.code||"@"===e.key?(t.triggerChatEvent("showAtDialog"),r.needDialog&&a.ruleShowPointDialog()):-1!==r.customTrigger.map((function(t){return t.prefix})).indexOf(e.key)&&(t.triggerChatEvent("showTagDialog",e.key),r.needDialog&&a.showCustomTagDialog(e.key));else{var n=!1;switch("Unidentified"===e.key?"android":"ios"){case"android":n=229===e.keyCode;break;case"ios":n=50===e.keyCode||"Digit2"===e.code||"@"===e.key}n&&(r.reformList.length>0||r.asyncMatch)&&s.showAt()&&(t.triggerChatEvent("showAtDialog"),r.needDialog&&t.target.showH5Dialog(),a.isExternalCallPopup=!1)}})),a.richText.addEventListener("keydown",(function(e){var n=e.target.classList.contains("input-write");if(!o.isPc&&"Unidentified"===e.key&&229===e.keyCode)return n&&s.mergeRuleInputTag(e.target),void(t.isIMEModel=!0);if(!t.isIMEModel){if(h(a.pcElms.pointDialogElm))return void(["ArrowUp","ArrowDown","Enter","NumpadEnter"].includes(e.code)?e.preventDefault():["ArrowLeft","ArrowRight"].includes(e.code)&&a.exitPointDialog());if(a.pcElms.customTagDialogTagKey&&h(a.pcElms.customTagDialogElms[a.pcElms.customTagDialogTagKey]))return void(["ArrowUp","ArrowDown","Enter","NumpadEnter"].includes(e.code)?e.preventDefault():["ArrowLeft","ArrowRight"].includes(e.code)&&a.exitCustomTagDialog());if("Backspace"===e.code||"Backspace"===e.key?n&&s.backRuleInputTag(e.target)||s.selectRegionMerge()||s.gridElmMerge()||s.delMarkRule()?(e.preventDefault(),t.richTextInput()):a.tipElm&&t.target.isEmpty()&&a.removeTipElm():r.wrapKeyFun(e)||!o.isPc&&"Enter"===e.key?(e.preventDefault(),n?s.setInputTagWrap(e.target):s.setWrap(),t.richTextInput()):r.sendKeyFun(e)?(e.preventDefault(),setTimeout((function(){t.triggerChatEvent("enterSend")}),100)):["ArrowLeft","ArrowRight"].includes(e.code)?(e.preventDefault(),n?s.inputTagSwitchRange(e.code):s.switchRange(e.code)):e.ctrlKey&&"KeyA"===e.code?t.target.isEmpty()&&e.preventDefault():e.ctrlKey&&"KeyZ"===e.code?(e.preventDefault(),t.ruleChatEvent((function(){t.target.undo()}),"defaultAction","UNDO")):e.ctrlKey&&"KeyY"===e.code&&(e.preventDefault(),t.ruleChatEvent((function(){t.target.redo()}),"defaultAction","REDO")),!e.ctrlKey&&!e.altKey&&!e.metaKey){var i=-1===t.notMergeKey.indexOf(e.key);n?(i||"Backspace"===e.code||"Backspace"===e.key)&&s.mergeRuleInputTag(e.target):i&&s.selectRegionMerge()}}})),a.richText.addEventListener("beforeinput",(function(n){var r=n.target.classList.contains("input-write");if(t.isIMEModel){if("insertParagraph"===n.inputType)return n.preventDefault(),r?s.setInputTagWrap(n.target):s.setWrap(),void t.richTextInput();if("deleteContentBackward"===n.inputType){t.takeIMEModel=!0,n.preventDefault();var o=a.richText.innerHTML,c=window.getSelection(),l=c.focusNode,u=c.focusOffset,h=r?l.parentElement.parentElement.parentElement:l.parentElement.parentElement,d=h.parentElement,p=Array.prototype.indexOf.call(a.richText.children,d),g=Array.prototype.indexOf.call(d.children,h);t.target.nextTick((function(){a.richText.innerHTML=o;var n=a.richText.children[p].children[g],c=r?n.children[0].children[0].childNodes[0]:n.children[0].childNodes[0];r?(s.setInputTagRange(c,u),s.backRuleInputTag(c.parentElement)||(c.textContent=c.textContent.slice(0,u-1)+c.textContent.slice(u),s.setInputTagRange(c,u-1)),s.watchInputTag(c.parentElement)):(s.restCursorPos(c,u),s.selectRegionMerge()||s.gridElmMerge()||s.delMarkRule()||(c.textContent=c.textContent.slice(0,u-1)+c.textContent.slice(u),s.restCursorPos(c,u-1))),t.target.nextTick(i(e().mark((function n(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.richTextInput();case 2:t.takeIMEModel=!1,t.isIMEModel=!1;case 4:case"end":return e.stop()}}),n)}))))}))}}})),a.richText.addEventListener("input",function(){var n=i(e().mark((function n(i){var c;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=i.target.classList.contains("input-write"),!t.isIMEModel){e.next=7;break}if(!t.takeIMEModel){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,t.target.nextTick((function(){c&&s.watchInputTag(i.target),void 0!==r.maxLength&&t.ruleMaxLength(),a.showPlaceholder(),t.triggerChatEvent("operate"),t.isIMEModel=!1}));case 6:return e.abrupt("return");case 7:if(!c){e.next=12;break}return s.watchInputTag(i.target),e.next=11,t.richTextInput();case 11:return e.abrupt("return");case 12:return e.next=14,t.richTextInput();case 14:o.isPc&&!t.isComposition&&t.debounceEvents.matchPointDialog();case 15:case"end":return e.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),a.richText.addEventListener("copy",(function(e){e.preventDefault(),t.ruleChatEvent((function(){t.copyRange(e)}),"defaultAction","COPY")})),a.richText.addEventListener("cut",(function(e){e.preventDefault(),t.ruleChatEvent((function(){t.copyRange(e),t.removeRange(),e.target.classList.contains("input-write")&&t.target.chatInput.watchInputTag(e.target)}),"defaultAction","CUT")})),a.richText.addEventListener("paste",(function(n){n.preventDefault();var a=t.target,r=a.options,o=a.chatInput;t.ruleChatEvent((function(){var a=n.clipboardData.getData("text/plain");if("string"==typeof a&&""!==a){if(-1===r.copyType.indexOf("text"))return;if(n.target.classList.contains("input-write"))return o.pasteInputTag(a),void t.richTextInput();var s=document.createElement("div");s.innerHTML=n.clipboardData.getData("application/my-custom-format")||"",o.selectRegionMerge(),s.children[0]&&s.children[0].getAttribute(g)===f?t.insertInsideHtml(s.innerHTML):(s.innerHTML=a,t.target.insertText(s.innerText)),s=null}else{if(-1===r.copyType.indexOf("image"))return;var c=(n.clipboardData||n.originalEvent.clipboardData).items||[];Array.from(c,function(){var n=i(e().mark((function n(i){var a,o,s;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==i.type.indexOf("image")){e.next=2;break}return e.abrupt("return");case 2:if(a=i.getAsFile(),!r.uploadImage){e.next=10;break}return e.next=6,r.uploadImage(a);case 6:o=e.sent,t.target.insertHtml('<img class="chat-img" src="'.concat(o,'" alt="" />')),e.next=12;break;case 10:(s=new FileReader).onload=function(e){t.target.insertHtml('<img class="chat-img" src="'.concat(e.target.result,'" alt="" />'))},s.readAsDataURL(a);case 12:case"end":return e.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}}),"defaultAction","PASTE")})),a.richText.addEventListener("blur",(function(){s.upDataNodeOrIndex()})),a.richText.addEventListener("focus",(function(){s.upDataNodeOrIndex()})),a.richText.addEventListener("click",(function(e){s.upDataNodeOrIndex();var n=L(e.target,5);if(n){var i=n.children[0];if(i.classList.contains("chat-grid-input"))return void t.triggerChatEvent("elementClicked","gridInput",i);if(i.classList.contains("at-input"))return i.children[0].textContent===s.VOID_KEY&&s.rangeToInputTag(i),void t.triggerChatEvent("elementClicked","inputTag",i);if(i.classList.contains("at-select")){var a=i.getAttribute("data-select-key");return t.triggerChatEvent("showSelectDialog",a,i),r.needDialog&&t.target.showPCSelectDialog(a,i),void t.triggerChatEvent("elementClicked","selectTag",i)}if(i.classList.contains("at-user"))return void t.triggerChatEvent("elementClicked","userTag",i);if(i.classList.contains("at-tag"))return void t.triggerChatEvent("elementClicked","customTag",i);if(i.classList.contains("chat-set-html"))return void t.triggerChatEvent("elementClicked","htmlTag",i.children[0])}})),a.richText.addEventListener("dragstart",(function(t){t.stopPropagation(),t.preventDefault()})),a.richText.addEventListener("dragover",(function(t){t.stopPropagation(),t.preventDefault()})),a.richText.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault()})),a.richText.addEventListener("compositionstart",(function(){t.isComposition=!0})),a.richText.addEventListener("compositionend",(function(){t.isComposition=!1})),window.addEventListener("click",this.winClick.bind(this)),window.addEventListener("keydown",this.winKeydown.bind(this))}},{key:"otherEvent",value:function(){var t=this,e=this.target,n=e.options,i=e.chatInput,a=e.chatElement,r=n.needDebounce,o=function(){var e=i.getRichTextNodeIndex(i.vnode),n=e.gridIndex,r=e.markIndex;if(null!==n&&null!=r){var o={html:a.richText.innerHTML,gridIndex:n,markIndex:r,cursorIndex:i.cursorIndex};t.undoHistory.push(o),t.undoHistory.length>50&&t.undoHistory.shift()}};this.debounceEvents.recordHistory=r?C(o,200):o;var s=function(t){var e="0",n="100%",r=i.getRangeRect();if(r){var o=a.pcElms.containerDialogElm.getBoundingClientRect(),s=r.x-o.x,c=o.y-r.y,l=t.clientWidth,u=t.clientHeight;r.x>window.innerWidth-l-30&&(s=r.x-l-o.x-16,e="100%"),r.y<u&&(c-=u,n="0"),t.style.transform="translate(0, 0)",t.style.transformOrigin="".concat(e," ").concat(n),t.style.left=s+6+"px",t.style.bottom="".concat(c,"px"),t.style.opacity="1"}};this.debounceEvents.dialogMoveToRange=r?C(s,120,!0):s;var c=function(){if(n.needDialog){var e=i.vnode.textContent||"",r=i.cursorIndex,o=e.slice(0,r),s=-1,c=-1,u="userTag";-1!==o.lastIndexOf("@")&&(s=o.lastIndexOf("@")),a.pcElms.customTagDialogTagKey&&-1!==o.lastIndexOf(a.pcElms.customTagDialogTagKey)&&(c=o.lastIndexOf(a.pcElms.customTagDialogTagKey));var h=t.tagProps[a.pcElms.customTagDialogTagKey];if(h&&-1!==o.lastIndexOf(h)&&(c=o.lastIndexOf(h)),c>s&&(u="customTag"),"userTag"===u&&n.asyncMatch){if(s<0)return void a.exitPointDialog();t.matchKey++;var d=t.matchKey;t.startOpenIndex=s+1;var p=o.slice(t.startOpenIndex)||"";if(/\s/gi.test(p))return void a.exitPointDialog();t.target.updateUserList([]),l(a.pcElms.pointDialogLoadingElm,!0,"flex"),l(a.pcElms.pointDialogEmptyElm),a.showPointDialog();var g=t.triggerChatEvent("atMatch",p).find((function(t){return t&&t instanceof Promise}));g&&g.then((function(e){if(d===t.matchKey){if(l(a.pcElms.pointDialogLoadingElm),!e||e.length<=0)return void l(a.pcElms.pointDialogEmptyElm,!0,"flex");t.target.updateUserList(e),a.pcElms.pointDialogUsersElm&&a.pcElms.pointDialogUsersElm.length>0&&a.updatePointActiveUserElm(a.pcElms.pointDialogUsersElm[0].elm)}}))}else if(!("userTag"===u&&n.reformList.length<=0||"customTag"===u&&a.customTags[a.pcElms.customTagDialogTagKey].length<=0)){var m=function(){"userTag"===u?a.exitPointDialog():a.exitCustomTagDialog()};if(s<0&&c<0)return a.exitPointDialog(),void a.exitCustomTagDialog();t.startOpenIndex="userTag"===u?s+1:c+1;var f=new RegExp("^([".concat(i.ZERO_WIDTH_KEY).concat(i.VOID_KEY,"])+$"));if(!o||f.test(o)||r<t.startOpenIndex)m();else{var E=o.slice(t.startOpenIndex)||"";if(/\s/gi.test(E))m();else if(E)if("userTag"===u){var v=t.target.searchUserList(E);v.length>0?a.showPointDialog(v):m()}else{var x=a.customTags[a.pcElms.customTagDialogTagKey].filter((function(t){return T(t.name,t.pinyin||"",E)}));x.length>0?a.showCustomTagDialog(a.pcElms.customTagDialogTagKey,x):m()}else"userTag"===u?a.showPointDialog():a.showCustomTagDialog(a.pcElms.customTagDialogTagKey)}}}};this.debounceEvents.matchPointDialog=r?C(c,200):c;this.debounceEvents.movePointActiveUserElm=b((function(t){if(a.pcElms.pointDialogActiveElm){var e=0,n=a.pcElms.pointDialogActiveElm.getAttribute("data-set-id");a.pcElms.pointDialogUsersElm.some((function(t){var i=t.elm.getAttribute("data-set-id");return e=t.index,n===i}));var i,r=a.pcElms.pointDialogUsersElm.filter((function(t){return!t.elm.classList.contains("user-no-match")})),o=r.map((function(t){return t.index}));"down"===t?i=e===r[r.length-1].index?r[0]:r[o.indexOf(e)+1]:"up"===t&&(i=e===r[0].index?r[r.length-1]:r[o.indexOf(e)-1]),i&&a.updatePointActiveUserElm(i.elm,!0)}}),80);this.debounceEvents.moveCustomActiveTagElm=b((function(t){if(a.pcElms.customTagDialogActiveElm){var e,n=a.customTags[a.pcElms.customTagDialogTagKey].map((function(t){return t.id})),i=a.pcElms.customTagDialogActiveElm.getAttribute("data-set-id"),r=n.indexOf(i),o=Array.from(a.pcElms.customTagDialogElms[a.pcElms.customTagDialogTagKey].children[1].children,(function(t,e){return{elm:t,index:e}})).filter((function(t){return!t.elm.classList.contains("tag-no-match")})),s=o.map((function(t){return t.index}));"down"===t?e=r===o[o.length-1].index?o[0]:o[s.indexOf(r)+1]:"up"===t&&(e=r===o[0].index?o[o.length-1]:o[s.indexOf(r)-1]),e&&a.updateActiveCustomTagElm(e.elm,!0)}}),80);var u=function(){var t=a.pcElms.selectDialogAim.getClientRects()[0],e=a.pcElms.selectDialogElms[a.pcElms.selectDialogKey];l(e,!0);var n=e.querySelector(".chat-select-arrow"),i=e.clientHeight+16;if(i>t.y?(i=-(t.height+16),n.style.top="-16px",n.style.bottom="auto",n.style.transform="rotate(0deg)"):(n.style.transform="rotate(180deg)",n.style.bottom="-16px",n.style.top="auto"),window.innerWidth-t.x<e.clientWidth){var r=e.clientWidth-(window.innerWidth-t.x)-10;e.style.left="auto",e.style.right="10px",n.style.left="auto",n.style.right=r-n.clientWidth/2+t.width/2+"px"}else e.style.left=t.x+"px",e.style.right="auto",n.style.left=t.width/2-n.clientWidth/2+"px",n.style.right="auto";e.style.top=t.y+"px",e.style.transform="translateY(".concat(-i,"px)");var o=e.querySelector(".chat-select-dialog-main"),s=e.querySelectorAll(".chat-select-dialog-item"),c=0,u=!1,h=0;if(a.pcElms.selectDialogAim.classList.contains("at-select")){var p=a.pcElms.selectDialogAim.getAttribute("data-select-id");d(a.pcElms.selectDialogAim,"aim",!0),Array.from(s,(function(t){var e=t.lastChild.lastChild,n=p===t.getAttribute("data-set-id");n&&(h=t.clientHeight,u=!0),!n&&!u&&(c+=t.clientHeight),l(e,n,"inline-block")}));var g=c-o.clientHeight/2+h/2;o.scrollTop=g>0?g:0}else Array.from(s,(function(t){l(t.lastChild.lastChild,!1,"inline-block")}))};this.debounceEvents.selectDialogToAim=r?C(u,120):u;var h={html:a.richText.innerHTML,gridIndex:0,markIndex:0,cursorIndex:i.cursorIndex};this.undoHistory=[h]}},{key:"winClick",value:function(){if(this.target&&!this.outerApply){var t=this.target.chatElement;h(t.pcElms.pointDialogElm)&&t.exitPointDialog(),t.pcElms.checkDialogSearchResultElm&&l(t.pcElms.checkDialogSearchResultElm),t.pcElms.customTagDialogTagKey&&h(t.pcElms.customTagDialogElms[t.pcElms.customTagDialogTagKey])&&t.exitCustomTagDialog(),t.pcElms.selectDialogKey&&h(t.pcElms.selectDialogElms[t.pcElms.selectDialogKey])&&t.exitSelectDialog()}}},{key:"winKeydown",value:(c=i(e().mark((function t(n){var i,a,r,o,s,c,l;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.target){t.next=2;break}return t.abrupt("return");case 2:if(i=this.target,a=i.chatElement,r=i.options,n.ctrlKey&&"KeyZ"===n.code&&n.preventDefault(),this.isComposition){t.next=48;break}if(!h(a.pcElms.pointDialogElm)){t.next=27;break}if("ArrowDown"!==n.code){t.next=8;break}return n.preventDefault(),this.debounceEvents.movePointActiveUserElm("down"),t.abrupt("return");case 8:if("ArrowUp"!==n.code){t.next=11;break}return n.preventDefault(),this.debounceEvents.movePointActiveUserElm("up"),t.abrupt("return");case 11:if("Enter"!==n.code&&"NumpadEnter"!==n.code||!a.pcElms.pointDialogActiveElm){t.next=25;break}return n.preventDefault(),o=a.pcElms.pointDialogActiveElm.getAttribute("data-set-id"),t.next=16,D(100);case 16:if(!a.isPointSearchMode&&!r.asyncMatch){t.next=21;break}return t.next=19,this.target.matchSetTag(r.reformList.find((function(t){return t.id===o})));case 19:t.next=24;break;case 21:return s=r.userList.find((function(t){return String(t[r.userProps.id])===o})),t.next=24,this.target.onceSetTag(s);case 24:a.exitPointDialog();case 25:t.next=48;break;case 27:if(!a.pcElms.customTagDialogTagKey||!h(a.pcElms.customTagDialogElms[a.pcElms.customTagDialogTagKey])){t.next=48;break}if("ArrowDown"!==n.code){t.next=31;break}return n.preventDefault(),this.debounceEvents.moveCustomActiveTagElm("down"),t.abrupt("return");case 31:if("ArrowUp"!==n.code){t.next=34;break}return n.preventDefault(),this.debounceEvents.moveCustomActiveTagElm("up"),t.abrupt("return");case 34:if("Enter"!==n.code&&"NumpadEnter"!==n.code||!a.pcElms.customTagDialogActiveElm){t.next=48;break}return n.preventDefault(),c=a.pcElms.customTagDialogActiveElm.getAttribute("data-set-id"),t.next=39,D(100);case 39:if(l=a.customTags[a.pcElms.customTagDialogTagKey].find((function(t){return t.id===c})),!a.isPointSearchMode){t.next=45;break}return t.next=43,this.target.matchSetCustomTag(l);case 43:t.next=47;break;case 45:return t.next=47,this.target.onceSetCustomTag(l);case 47:a.exitCustomTagDialog();case 48:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"richTextInput",value:(r=i(e().mark((function t(){var n,i,a,r,o,s,c=this,l=arguments;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=!(l.length>0&&void 0!==l[0])||l[0],i=this.target,a=i.chatInput,r=i.deviceInfo,o=i.chatElement,s=i.options,a.upDataNodeOrIndex(),r.isPc&&a.selectRegionMerge(),t.next=6,this.target.nextTick((function(){c.isComposition||a.updateGrid();var t=(o.richText.children[0]||{children:[]}).children[0];if(!t||!t.getAttribute||t.getAttribute(g)!==E)return a.initEditor(!0),o.showPlaceholder(),void c.triggerChatEvent("operate");void 0!==s.maxLength&&c.ruleMaxLength(),o.showPlaceholder(),c.triggerChatEvent("operate"),n&&c.doOverHistory&&!c.isComposition&&c.debounceEvents.recordHistory(),a.viewIntoPoint()}));case 6:return t.abrupt("return",!0);case 7:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"ruleMaxLength",value:function(){var t=this,e=this.target,n=e.options,i=e.chatElement;if(this.target.isEmpty()||void 0===n.maxLength)this.textLength=0;else{var a=0,r=0,o=[];Array.prototype.some.call(i.richText.children,(function(e,i){var s=t.getGirdNodeTextInfo(e),c=s.nodeInfos,l=s.nodeTextLength;if(a+=l,o.push(c),r=i,a>=n.maxLength)return!0}));var s=[];Array.from(i.richText.children,(function(t,e){e>r&&s.push(t)})),s.forEach((function(t){return i.richText.removeChild(t)})),this.deepDelGirdText(o,a)}}},{key:"getGirdNodeTextInfo",value:function(t){var e=this.target.chatInput,n=[],i=0;if(1===t.children.length&&t!==t.parentElement.children[0]){var a=t.children[0],r=(a.textContent||"").replace(new RegExp(e.VOID_KEY,"g"),"");i+=r.length||1,n[0]={node:a,textLength:r.length||1,type:E}}else Array.from(t.children,(function(t,a){if(t.getAttribute(g)===E){var r=(t.textContent||"").replace(new RegExp(e.VOID_KEY,"g"),"");i+=r.length,n[a]={node:t,textLength:r.length,type:E}}else{var o=(t.textContent||"").replace(new RegExp(e.VOID_KEY,"g"),"");i+=o.length||1,n[a]={node:t,textLength:o.length||1,type:x}}}));return{nodeInfos:n,nodeTextLength:i}}},{key:"deepDelGirdText",value:function(t,e){if(e>this.target.options.maxLength){var n=t[t.length-1];t.pop(),this.deepDelNode(n,t,e)}else this.textLength=e}},{key:"deepDelNode",value:function(t,e,n){var i=t[0].node.parentElement;if(n>this.target.options.maxLength){var a=n-this.target.options.maxLength,r=t[t.length-1];if(r.type===E)if(0===r.textLength||a>=r.textLength)i.removeChild(r.node),t.pop(),a-=r.textLength,r=t[t.length-1],i.removeChild(r.node),t.pop(),a-=r.textLength;else{var o=r.node.childNodes[0];o.textContent=o.textContent.slice(0,r.textLength-a),0===o.textContent&&(o.setAttribute(p,"true"),o.innerHTML="".concat(this.target.chatInput.VOID_KEY,"<br>")),a=0}else i.removeChild(r.node),t.pop(),a-=r.textLength;a>0?t.length>0?this.deepDelNode(t,e,a+this.target.options.maxLength):(this.target.chatElement.richText.appendChild(i),this.deepDelGirdText(e,a+this.target.options.maxLength)):(this.textLength=this.target.options.maxLength+a,this.target.chatInput.setRangeLastText())}}},{key:"copyRange",value:function(t){var e=window.getSelection();if(e.isCollapsed||e.rangeCount<=0)return t.clipboardData.setData("application/my-custom-format",""),void t.clipboardData.setData("text/plain","");var n=this.target,i=n.chatElement,a=n.chatInput,r=e.toString()||"",o=document.createElement("div");o.innerHTML=r;var s=o.innerText.replace(/\n\n/g,"\n");o=null,t.clipboardData.setData("text/plain",s);var c=e.anchorNode,l=e.focusNode;if(c!==l||c.nodeType!==Node.TEXT_NODE)if(c!==i.richText||l!==i.richText){var u=a.getWrapNode(c,!0),h=a.getWrapNode(l,!0),d=a.getMarkNode(c,!0),m=a.getMarkNode(l,!0),f=d.getAttribute(g)===E,v=m.getAttribute(g)===E,x=Array.prototype.indexOf.call(u.childNodes,d),D=Array.prototype.indexOf.call(h.childNodes,m);if(u===h&&u.parentNode===i.richText){var y=x>D,C=Array.prototype.filter.call(u.childNodes,(function(t,e){return y?e<x&&e>D:e>x&&e<D})).map((function(t){return t.cloneNode(!0)})),b=f?y?c.textContent.slice(0,e.anchorOffset):c.textContent.slice(e.anchorOffset):"",T=v?y?l.textContent.slice(e.focusOffset):l.textContent.slice(0,e.focusOffset):"",k=a.getGridElm(!0),A=a.getGridElm(!0);b&&(k.childNodes[0].innerHTML=b,k.childNodes[0].setAttribute(p,"false")),T&&(A.childNodes[0].innerHTML=T,A.childNodes[0].setAttribute(p,"false")),y?(C[0].getAttribute(g)!==E&&C.unshift(A),C[C.length-1].getAttribute(g)!==E&&C.push(k)):(C[0].getAttribute(g)!==E&&C.unshift(k),C[C.length-1].getAttribute(g)!==E&&C.push(A));var I=document.createElement("div"),w=a.setWrapNodeByMark(C);return I.appendChild(w),t.clipboardData.setData("application/my-custom-format",I.innerHTML),void(I=null)}if(u.parentNode===i.richText&&h.parentNode===i.richText){var L=Array.prototype.indexOf.call(i.richText.childNodes,u),N=Array.prototype.indexOf.call(i.richText.childNodes,h),F=L>N,P=Array.prototype.filter.call(i.richText.childNodes,(function(t,e){return F?e<L&&e>N:e>L&&e<N})).map((function(t){return t.cloneNode(!0)})),S=f?F?c.textContent.slice(0,e.anchorOffset):c.textContent.slice(e.anchorOffset):"",O=v?F?l.textContent.slice(e.focusOffset):l.textContent.slice(0,e.focusOffset):"",M=a.getGridElm(!0),R=a.getGridElm(!0);S&&(M.childNodes[0].innerHTML=S,M.childNodes[0].setAttribute(p,"false")),O&&(R.childNodes[0].innerHTML=O,R.childNodes[0].setAttribute(p,"false"));var _=Array.prototype.filter.call(u.childNodes,(function(t,e){return F?e<x:e>x})).map((function(t){return t.cloneNode(!0)})),K=Array.prototype.filter.call(h.childNodes,(function(t,e){return F?e>D:e<D})).map((function(t){return t.cloneNode(!0)}));if(F){_.push(M),K.unshift(R);var H=a.setWrapNodeByMark(_),B=a.setWrapNodeByMark(K);P.push(H),P.unshift(B)}else{_.unshift(M),K.push(R);var Y=a.setWrapNodeByMark(_),V=a.setWrapNodeByMark(K);P.unshift(Y),P.push(V)}var U=document.createElement("div");return Array.from(P,(function(t){U.appendChild(t)})),t.clipboardData.setData("application/my-custom-format",U.innerHTML),void(U=null)}}else t.clipboardData.setData("application/my-custom-format",i.richText.innerHTML);else t.clipboardData.setData("application/my-custom-format",s)}},{key:"removeRange",value:function(){var t=this.target,e=t.chatInput,n=t.chatElement;window.getSelection().getRangeAt(0).deleteContents(),this.target.nextTick((function(){e.updateGrid(),n.showPlaceholder()}))}},{key:"setChatHistory",value:(n=i(e().mark((function t(n){var i,a,r,o,s,c,l,u;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.target,a=i.chatElement,r=i.chatInput,this.doOverHistory=!1,o=n.html,s=n.gridIndex,c=n.markIndex,l=n.cursorIndex,a.richText.innerHTML=o,u=a.richText.childNodes[s].childNodes[c].childNodes[0].childNodes[0],r.restCursorPos(u,l),t.next=8,this.richTextInput();case 8:this.doOverHistory=!0;case 9:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"insertInsideHtml",value:(t=i(e().mark((function t(n){var i,a;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.target.chatInput,(a=document.createElement("div")).innerHTML=n,t.t0=a.children.length,!t.t0){t.next=9;break}return 1===a.children.length?i.insetRangeGrid(a.children[0]):i.insetRangeGrids(a.children),a=null,t.next=9,this.richTextInput();case 9:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"triggerChatEvent",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var a=[];return this.chatEventModule[t].forEach((function(t){t&&a.push(t.apply(void 0,n))})),a}},{key:"ruleChatEvent",value:function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];this.triggerChatEvent.apply(this,[e].concat(i)).some((function(t){return t&&"PREVENT"===t}))||(t&&t.bind(this)(),t=null)}}]);var t,n,r,c}(),G=function(){return o((function t(e){a(this,t),s(this,"target"),s(this,"rankLen",4),this.target=e}),[{key:"getCurrentNodes",value:function(){var t=this,e=[];return Array.from(this.target.chatElement.richText.children,(function(n,i){e.push(t.analyzeGrid(n,i))})),e}},{key:"getRank",value:function(t){for(var e=t+1+"",n=this.rankLen-e.length,i=0;i<n;i++)e="0"+e;return e}},{key:"analyzeGrid",value:function(t,e){var n=this,i={type:"gridBox",rank:this.getRank(e),children:[]};return Array.from(t.children,(function(t,e){switch(t.getAttribute(g)){case E:i.children.push(n.analyzeMark(t,e,i.rank));break;case x:i.children.push(n.analyzeTag(t,e,i.rank))}})),i}},{key:"analyzeMark",value:function(t,e,n){return{type:"gridInput",rank:n+this.getRank(e),text:t.textContent.replace(new RegExp(this.target.chatInput.VOID_KEY,"g"),"")}}},{key:"analyzeTag",value:function(e,n,i){var a=e.children[0],r={type:"htmlTag",rank:i+this.getRank(n)};return a.classList.contains("at-user")?(r.type="userTag",r.dataset=t(t({},this.target.options.userProps.id,a.getAttribute("data-user-id")),this.target.options.userProps.name,a.textContent.slice(1))):a.classList.contains("at-tag")?(r.type="customTag",r.dataset={id:a.getAttribute("data-tag-id"),name:a.textContent.slice(1),prefix:a.getAttribute("data-set-prefix")}):a.classList.contains("at-select")?(r.type="selectTag",r.dataset={id:a.getAttribute("data-select-id"),name:a.textContent,key:a.getAttribute("data-select-key")}):a.classList.contains("at-input")?(r.type="inputTag",r.dataset={key:a.getAttribute("data-input-key"),placeholder:a.children[1].textContent,value:a.children[0].textContent===this.target.chatInput.VOID_KEY?"":a.children[0].textContent.replace(new RegExp(this.target.chatInput.INPUT_TAG_WRAP_KEY[0],"g"),"")}):(r.type="htmlTag",r.html=e.children[0].innerHTML),r}},{key:"analyzeGridNodes",value:function(t){var e=this;t.children=t.children||[];var n=t.children;if(0!==n.length){var i=[];n.forEach((function(t,e){if(e!==n.length-1){var a=e+1;if("gridInput"===t.type&&"gridInput"===n[a].type){var r=a-i.length;i.push(r)}}})),i.forEach((function(t){var e=n[t];n[t-1].text+=e.text,n.splice(t,1)}));var a=[];n.forEach((function(t,e){if(e!==n.length-1){var i=e+1;if("gridInput"!==t.type&&"gridInput"!==n[i].type){var r=i+a.length;a.push(r)}}})),a.forEach((function(t){n.splice(t,0,{type:"gridInput",rank:"",text:""})})),"gridInput"!==n[0].type&&n.unshift({type:"gridInput",rank:"",text:""}),"gridInput"!==n[n.length-1].type&&n.push({type:"gridInput",rank:"",text:""}),n.forEach((function(n,i){n.rank=t.rank+e.getRank(i)}))}else n.push({type:"gridInput",rank:t.rank+this.getRank(0),text:""})}},{key:"analyzeNode",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t.type){case"gridInput":return"<span ".concat(g,'="').concat(E,'"><span class="chat-grid-input" ').concat(g,'="').concat(v,'" ').concat(p,'="').concat(String(""===t.text),'">').concat(""===t.text?this.target.chatInput.VOID_KEY:t.text).concat(n&&""===t.text?"<br>":"","</span></span>");case"userTag":return'<span class="chat-tag" contenteditable="false" '.concat(g,'="').concat(x,'"><span class="at-user" data-user-id="').concat(t.dataset[this.target.options.userProps.id],'">@').concat(t.dataset[this.target.options.userProps.name],"</span></span>");case"customTag":return'<span class="chat-tag" contenteditable="false" '.concat(g,'="').concat(x,'"><span class="at-tag" data-tag-id="').concat(t.dataset.id,'" data-set-prefix="').concat(t.dataset.prefix,'">').concat(t.dataset.prefix).concat(t.dataset.name,"</span></span>");case"selectTag":return'<span class="chat-tag" contenteditable="false" '.concat(g,'="').concat(x,'"><span class="at-select" data-select-id="').concat(t.dataset.id,'" data-select-key="').concat(t.dataset.key,'">').concat(t.dataset.name).concat(P,"</span></span>");case"htmlTag":return'<span class="chat-tag" contenteditable="false" '.concat(g,'="').concat(x,'"><span class="chat-set-html">').concat(t.html,"</span></span>");case"inputTag":var i=!t.dataset.value,a=i?'<span class="input-tip">'.concat(t.dataset.placeholder,"</span>"):'<span class="input-tip chat-view-show" style="display: none">'.concat(t.dataset.placeholder,"</span>");return'<span class="chat-tag" contenteditable="false" '.concat(g,'="').concat(x,'"><span class="at-input" contenteditable="false" data-input-key="').concat(t.dataset.key,'"><span class="input-write" contenteditable="true">').concat(i?this.target.chatInput.VOID_KEY:t.dataset.value.replace(new RegExp(this.target.chatInput.INPUT_TAG_WRAP_KEY[1],"g"),this.target.chatInput.INPUT_TAG_WRAP_KEY),"</span>").concat(a,"</span></span>");case"gridBox":var r="";return this.analyzeGridNodes(t),t.children.forEach((function(n,i){r+=e.analyzeNode(n,i===t.children.length-1)})),'<p class="chat-grid-wrap" '.concat(g,'="').concat(f,'">').concat(r,"</p>");default:return""}}},{key:"insertNode",value:(l=i(e().mark((function t(n){var i,a,r,o,s,c,l,u,h,d,p=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("gridBox"!==n.type){t.next=20;break}if(i=this.analyzeNode(n),(a=document.createElement("div")).innerHTML=i,r=a.children[0],!(-1==(o=parseFloat(n.rank)-1)||o>this.target.chatElement.richText.children.length-1)){t.next=9;break}this.target.chatElement.richText.appendChild(r),t.next=13;break;case 9:if(s=this.target.chatElement.richText.children[o]){t.next=12;break}return t.abrupt("return");case 12:this.target.chatElement.richText.insertBefore(r,s);case 13:return c=r.lastElementChild.children[0].childNodes[0],this.target.chatInput.restCursorPos(c,c.textContent===this.target.chatInput.VOID_KEY?1:c.textContent.length),a=null,t.next=18,this.target.chatEvent.richTextInput();case 18:t.next=27;break;case 20:if(l=(n.text||"").length,u=n.rank.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),h=this.getNodeByRank(u[0])){t.next=23;break}return t.abrupt("return");case 23:return-1==(d=parseFloat(u[1])-1)?h.children.push(n):h.children.splice(d,0,n),t.next=27,this.updateNode(h,(function(){if("gridInput"===n.type){var t=-1===d||d>h.children.length-1,e=!t&&d%2==0,i=t?h.children[h.children.length-1]:h.children[e?d:d-1];p.setCursorNode(i,e?l:-1)}else{var a=h.children.indexOf(n);p.setCursorNode(h.children[a+1],0)}}));case 27:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"updateNode",value:(c=i(e().mark((function t(n,i){var a,r,o,s,c,l,u,h,d,g,m,f,E,v,x,D=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.rank.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),r=parseFloat(a[0])-1,o=this.target.chatElement.richText.children[r],"gridBox"!==n.type){t.next=10;break}if(o){t.next=4;break}return t.abrupt("return");case 4:return this.analyzeGridNodes(n),s="",n.children.forEach((function(t,e){s+=D.analyzeNode(t,e===n.children.length-1)})),o.innerHTML=s,i?i():(c=o.lastElementChild.children[0].childNodes[0],this.target.chatInput.restCursorPos(c,c.textContent===this.target.chatInput.VOID_KEY?1:c.textContent.length)),t.next=9,this.target.chatEvent.richTextInput();case 9:return t.abrupt("return");case 10:if(l=parseFloat(a[1])-1,u=o.children[l],(h=this.getNodeByRank(n.rank))&&n.type===h.type){t.next=13;break}return t.abrupt("return");case 13:return"gridInput"===n.type?((m=u.children[0]).textContent=n.text,f=""!==m.textContent,m.setAttribute(p,String(!f)),f||(m.innerHTML=u.nextElementSibling?this.target.chatInput.VOID_KEY:"".concat(this.target.chatInput.VOID_KEY,"<br>")),d=m.childNodes[0],g=d.textContent.length):"userTag"===n.type?((E=u.children[0]).setAttribute("data-user-id",n.dataset[this.target.options.userProps.id]),E.textContent="@".concat(n.dataset[this.target.options.userProps.name]),d=u.nextElementSibling.children[0].childNodes[0]):"customTag"===n.type?((v=u.children[0]).setAttribute("data-tag-id",n.dataset.id),v.setAttribute("data-set-prefix",n.dataset.prefix),v.textContent="".concat(n.dataset.prefix).concat(n.dataset.name),d=u.nextElementSibling.children[0].childNodes[0]):"selectTag"===n.type?((x=u.children[0]).setAttribute("data-select-id",n.dataset.id),x.setAttribute("data-select-key",n.dataset.key),x.childNodes[0].textContent=n.dataset.name,d=u.nextElementSibling.children[0].childNodes[0]):"htmlTag"===n.type&&(u.children[0].innerHTML=n.html,d=u.nextElementSibling.children[0].childNodes[0]),i?i():this.target.chatInput.restCursorPos(d,g),t.next=17,this.target.chatEvent.richTextInput();case 17:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"getNodeByRank",value:function(t){if(!t)return null;var e=t.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g"));if(0===e.length)return null;var n=parseFloat(e[0])-1,i=-1===n?this.target.chatElement.richText.lastElementChild:this.target.chatElement.richText.children[n];if(!i)return null;if(1===e.length)return this.analyzeGrid(i,-1===n?this.target.chatElement.richText.children.length-1:n);-1===n&&(e[0]=this.getRank(this.target.chatElement.richText.children.length-1));var a=parseFloat(e[1])-1,r=-1===a?i.lastElementChild:i.children[a];return r?r.getAttribute(g)===E?this.analyzeMark(r,-1===a?i.children.length-1:a,e[0]):this.analyzeTag(r,-1===a?i.children.length-1:a,e[0]):null}},{key:"delNodeByRank",value:(r=i(e().mark((function t(n){var i,a,r,o,s,c,l,u,h,d=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i=this.getNodeByRank(n))){t.next=21;break}if("gridBox"!==i.type){t.next=11;break}return a=parseFloat(n)-1,r=this.target.chatElement.richText.children[a],(o=r.nextElementSibling||r.previousElementSibling)&&(s=o.lastElementChild.children[0].childNodes[0],this.target.chatInput.restCursorPos(s,s.textContent===this.target.chatInput.VOID_KEY?1:s.textContent.length)),this.target.chatElement.richText.removeChild(r),0===this.target.chatElement.richText.children.length&&this.target.chatInput.initEditor(!0),t.next=9,this.target.chatEvent.richTextInput();case 9:case 15:t.next=21;break;case 11:if("gridInput"!==i.type){t.next=17;break}return i.text="",t.next=15,this.updateNode(i);case 17:return c=i.rank.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),l=this.getNodeByRank(c[0]),u=l.children[parseFloat(c[1])-1-1],h=u.text.length,l.children=l.children.filter((function(t){return t.rank!==n})),t.next=21,this.updateNode(l,(function(){d.setCursorNode(u,h)}));case 21:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"coverNodes",value:(n=i(e().mark((function t(n){var i,a=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.length<0)){t.next=2;break}return t.abrupt("return");case 2:return i="",n.forEach((function(t){i+=a.analyzeNode(t)})),this.target.chatElement.richText.innerHTML=i,this.target.chatInput.setRangeLastText(),t.next=8,this.target.chatEvent.richTextInput();case 8:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"setCursorNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=t.rank.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),i=parseFloat(n[0])-1,a=-1===i?this.target.chatElement.richText.lastElementChild:this.target.chatElement.richText.children[i],r=null;if("gridInput"===t.type){var o=parseFloat(n[1])-1;r=-1===o?a.lastElementChild:a.children[o]}else if("gridBox"===t.type)r=-1===e?a.lastElementChild:a.children[0];else if("inputTag"===t.type){var s=parseFloat(n[1])-1,c=a.children[s].children[0].children[0].childNodes[0],l=c.textContent===this.target.chatInput.VOID_KEY?1:-1===e?c.textContent.length:e;this.target.chatInput.setInputTagRange(c,l)}else{var u=parseFloat(n[1])-1,h=a.children[u];r=-1===e?h.nextElementSibling:h.previousElementSibling,e=-1===e?0:-1}if(r){var d=r.children[0].childNodes[0];-1===e&&(e=d.textContent.length),this.target.chatInput.restCursorPos(d,d.textContent===this.target.chatInput.VOID_KEY?1:e)}}},{key:"getCursorNode",value:function(){var t=window.getSelection(),e=t.focusNode;if(e&&e.parentElement&&e.parentElement.classList.contains("input-write")){var n=e.parentElement.parentElement.parentElement;return{node:this.analyzeTag(n,Array.prototype.indexOf.call(n.parentElement.children,n),this.getRank(Array.prototype.indexOf.call(this.target.chatElement.richText.children,n.parentElement))),offset:e.textContent===this.target.chatInput.VOID_KEY?0:t.focusOffset}}var i=this.target.chatInput.vnode.parentElement.parentElement;return{node:this.analyzeMark(i,Array.prototype.indexOf.call(i.parentElement.children,i),this.getRank(Array.prototype.indexOf.call(this.target.chatElement.richText.children,i.parentElement))),offset:this.target.chatInput.vnode.textContent===this.target.chatInput.VOID_KEY?0:this.target.chatInput.cursorIndex}}},{key:"setSelectNodes",value:function(t,e){var n,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=t.rank.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),s=e.rank.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),c=this.target.chatElement.richText.children[parseFloat(o[0])-1],l=this.target.chatElement.richText.children[parseFloat(s[0])-1];if("gridInput"===t.type)n=c.children[parseFloat(o[1])-1];else if("gridBox"===t.type)n=-1===a?c.lastElementChild:c.children[0];else{var u=parseFloat(o[1])-1,h=c.children[u];n=-1===a?h.nextElementSibling:h.previousElementSibling,a=-1===a?0:-1}if("gridInput"===e.type)i=l.children[parseFloat(s[1])-1];else if("gridBox"===t.type)i=-1===r?l.lastElementChild:l.children[0];else{var d=parseFloat(s[1])-1,p=l.children[d];i=-1===r?p.nextElementSibling:p.previousElementSibling,r=-1===r?0:-1}var g=n.children[0].childNodes[0],m=i.children[0].childNodes[0],f=document.createRange(),E=parseFloat(t.rank)>parseFloat(e.rank);f[E?"setEnd":"setStart"](g,g.textContent===this.target.chatInput.VOID_KEY?1:-1===a?g.textContent.length:a),f[E?"setStart":"setEnd"](m,m.textContent===this.target.chatInput.VOID_KEY?1:-1===r?m.textContent.length:r);var v=window.getSelection();v.removeAllRanges(),v.addRange(f)}},{key:"getElmByRank",value:function(t){var e=t.match(new RegExp(".{1,".concat(this.rankLen,"}"),"g")),n=parseFloat(e[0])-1,i=-1===n?this.target.chatElement.richText.lastElementChild:this.target.chatElement.richText.children[n];if(1===e.length)return i;var a=parseFloat(e[1])-1;return-1===a?i.lastElementChild:i.children[a]}},{key:"getRankByElm",value:function(t){var e=this.target.chatElement.richText.children,n=null,i=null;return Array.prototype.find.call(e,(function(e,a){return t===e?(n=a,!0):Array.prototype.find.call(e.children,(function(e,r){return e===t&&(n=a,i=r,!0)}))})),(null!==n?this.getRank(n):"")+(null!==i?this.getRank(i):"")}}]);var n,r,c,l}(),W=function(t,e,n){return t.forEach((function(t){if(n in t){var i=e.indexOf(String(t[n]));-1!==i&&(e[i]=t)}})),e.filter((function(t){return t[n]}))},j=function(){return o((function t(e){var n=this;switch(a(this,t),s(this,"options"),s(this,"deviceInfo",function(){var t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),n=/(?:SymbianOS)/.test(t)||e,i=/(?:Android)/.test(t),a=/(?:Firefox)/.test(t),r=/(?:iPad|PlayBook)/.test(t)||i&&!/(?:Mobile)/.test(t)||a&&/(?:Tablet)/.test(t),o=/(?:iPhone)/.test(t)&&!r;return{isTablet:r,isPhone:o,isAndroid:i,isPc:!o&&!i&&!n}}()),s(this,"chatElement"),s(this,"chatInput"),s(this,"chatEvent"),this.options=Object.assign({},M,e),this.options.device=this.options.device.toLocaleLowerCase(),this.deviceInfo.isTablet&&(this.deviceInfo.isPc=!1),this.options.device){case"pc":this.deviceInfo.isPc=!0;break;case"h5":this.deviceInfo.isPc=!1}this.options.userProps=Object.assign({},R,e.userProps||{}),this.options.dialogLabels.pcPointDialog=Object.assign({},_,N(e.dialogLabels,"pcPointDialog",{})),this.options.dialogLabels.pcPCheckDialog=Object.assign({},K,N(e.dialogLabels,"pcPCheckDialog",{})),this.options.dialogLabels.h5Dialog=Object.assign({},H,N(e.dialogLabels,"h5Dialog",{})),this.chatElement=new S(this),this.chatInput=new O(this),this.chatEvent=new U(this),this.updateConfig(e);var i=this;Object.defineProperty(this,"richText",{get:function(){return i.chatElement.richText}}),Object.defineProperty(this,"textLength",{get:function(){return i.chatEvent.textLength}}),this.options.autoFocus&&this.nextTick((function(){n.chatElement.richText.focus()}))}),[{key:"updateConfig",value:function(t){void 0!==t.copyType&&(this.options.copyType=t.copyType),t.userProps&&(this.options.userProps=Object.assign({},R,t.userProps)),void 0!==t.uploadImage&&(this.options.uploadImage=t.uploadImage),void 0!==t.placeholder&&(this.chatElement.placeholderElm.textContent=t.placeholder),void 0!==t.maxLength&&(this.options.maxLength=t.maxLength,this.chatEvent.ruleMaxLength()),(this.options.asyncMatch||void 0!==t.needCallEvery||t.userList)&&(this.options.needCallEvery=!this.options.asyncMatch&&y(void 0===t.needCallEvery?this.options.needCallEvery:t.needCallEvery),this.updateUserList(this.options.asyncMatch?[]:t.userList)),void 0!==t.needCallSpace&&this.chatInput.setCallSpace(y(t.needCallSpace)),void 0!==t.wrapKeyFun&&(this.options.wrapKeyFun=t.wrapKeyFun),void 0!==t.sendKeyFun&&(this.options.sendKeyFun=t.sendKeyFun),this.options.needDialog&&t.customTrigger&&this.deviceInfo.isPc&&(this.options.customTrigger=t.customTrigger,this.chatElement.bindCustomTrigger()),this.options.needDialog&&t.selectList&&this.deviceInfo.isPc&&(this.options.selectList=t.selectList,this.chatElement.bindSelectList())}},{key:"updateUserList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=this.options,i=this.chatElement;if(e){n.userList=JSON.parse(JSON.stringify(e));var a=t(t({},n.userProps.id,"isALL"),n.userProps.name,"");n.userList.unshift(a),n.reformList=e.map((function(t,e){var i=t[n.userProps.id];if(!i&&0!==i)throw new Error("配置项userList：下标第".concat(e,"项").concat(n.userProps.id,"值异常！"));return{id:String(i),name:String(t[n.userProps.name]||""),avatar:String(t[n.userProps.avatar]||""),pinyin:String(t[n.userProps.pinyin]||"")}}))}var r=n.userList[0];r&&"isALL"===r[n.userProps.id]&&(r[n.userProps.name]=this.deviceInfo.isPc?n.dialogLabels.pcPointDialog.callEveryLabel:n.dialogLabels.h5Dialog.callEveryLabel),n.needDialog&&(this.deviceInfo.isPc?i.updatePCUser():i.updateH5User())}},{key:"searchUserList",value:function(t){return this.options.reformList.filter((function(e){return T(e.name,e.pinyin||"",t)}))}},{key:"getReduceNode",value:function(t){var e=this,n=Object.assign({},B,t||{});n.saveTagData&&(n.needUserId=!0,n.needTagId=!0,n.needSelectId=!0);var i=/(https?|http|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g,a=this.chatElement.richText.cloneNode(!0).children||[],r=document.createElement("div");return n.wrapClassName&&(r.className=n.wrapClassName),Array.from(a,(function(t,a){var o=document.createElement("p");Array.from(t.children,(function(t){var a=t.children[0];e.chatInput.getNodeEmpty(a)||(a.removeAttribute(g),a.removeAttribute("contenteditable"),a.removeAttribute(p),n.needUserId||a.removeAttribute("data-user-id"),n.needTagId||(a.removeAttribute("data-set-prefix"),a.removeAttribute("data-tag-id")),n.needSelectId||(a.removeAttribute("data-select-id"),a.removeAttribute("data-select-key")),n.imgToText&&a.firstChild&&"IMG"===a.firstChild.tagName&&(a.classList.add("img-to-text"),a.innerHTML="[".concat(a.firstChild.getAttribute("data-img-text")||"you need set data-img-text","]")),n.identifyLink&&a.classList.contains("chat-grid-input")&&(a.innerHTML=a.innerHTML.replace(i,(function(t){return'<a class="chat-grid-link" href="'.concat(t,'" target="_blank">').concat(t,"</a>")}))),a.classList.contains("at-select")&&(a.classList.remove("aim"),a.removeChild(a.lastChild)),a.classList.contains("at-input")&&(n.saveTagData?a.setAttribute("data-input-tip",a.children[1].textContent):a.removeAttribute("data-input-key"),a.textContent=a.children[0].textContent!==e.chatInput.VOID_KEY?a.children[0].textContent:a.children[1].textContent,a.textContent=a.textContent.replace(new RegExp(e.chatInput.INPUT_TAG_WRAP_KEY[0],"g"),"")),o.appendChild(a))})),n.rowClassName&&(o.className=n.rowClassName),o.innerHTML||(o.innerHTML="<br>"),r.appendChild(o)})),r}},{key:"getText",value:function(t){var e="",n=this.getReduceNode(t);return Array.from(n.children,(function(t,n){e=e+(n>0?"\n":"")+t.textContent})),e}},{key:"getHtml",value:function(t){return this.getReduceNode(t).innerHTML}},{key:"reverseAnalysis",value:(Z=i(e().mark((function t(n,i){var a,r,o=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if((a=document.createElement("div")).innerHTML=n,r=a.children,Array.from(r,(function(t){t.className="chat-grid-wrap",t.setAttribute(g,f);var e=t.children,n={},i=[];for(var a in Array.from(e,(function(a,r){if(-1!==a.className.indexOf("chat-grid-input")){var s=a.textContent||"";return a.className="",a.setAttribute(g,E),void(a.innerHTML='<span class="chat-grid-input" '.concat(g,'="').concat(v,'" ').concat(p,'="false">').concat(s,"</span>"))}if(a.tagName&&"BR"===a.tagName.toLocaleUpperCase()){var c=o.chatInput.getGridElm(!0);return t.removeChild(a),void t.appendChild(c)}var l=a.cloneNode(!0);l.setAttribute("contenteditable","false");var u=document.createElement("span");u.className="chat-tag",u.setAttribute("contenteditable","false"),u.setAttribute(g,x),u.appendChild(l),n[r]=u,r!==e.length-1?-1===e[r+1].className.indexOf("chat-grid-input")&&i.push(r):i.push(r),0===r&&i.push(-1)})),n){var r=Number(a),s=n[a].lastChild;if(s.classList.contains("at-select"))s.innerHTML="".concat(s.textContent).concat(P);else if(s.classList.contains("at-input")){var c=""===s.textContent,l=c?'<span class="input-tip">'.concat(s.getAttribute("data-input-tip"),"</span>"):'<span class="input-tip chat-view-hidden" style="display: none">'.concat(s.getAttribute("data-input-tip"),"</span>");s.innerHTML='<span class="input-write" contenteditable="true">'.concat(c?o.chatInput.VOID_KEY:s.textContent.replace(new RegExp(o.chatInput.INPUT_TAG_WRAP_KEY[1],"g"),o.chatInput.INPUT_TAG_WRAP_KEY),"</span>").concat(l),s.removeAttribute("data-input-tip")}r===e.length-1?(t.removeChild(e[r]),t.appendChild(n[a])):(t.insertBefore(n[a],e[r+1]),t.removeChild(e[r]))}var u=[],h=t.children;i.forEach((function(t){t===h.length-1?u.push("isEnd"):u.push(h[t+1])})),u.forEach((function(e){var n=o.chatInput.getGridElm(!0);if("isEnd"===e)t.appendChild(n);else{var i=n.children[0];i.childNodes.length>1&&i.removeChild(i.childNodes[1]),t.insertBefore(n,e)}}))})),!i){t.next=12;break}return this.chatInput.setRangeLastText(),t.next=10,this.chatEvent.insertInsideHtml(a.innerHTML);case 10:t.next=16;break;case 12:return this.chatElement.richText.innerHTML=a.innerHTML,this.chatInput.setRangeLastText(),t.next=16,this.chatEvent.richTextInput();case 16:case"end":return t.stop()}}),t,this)}))),function(t,e){return Z.apply(this,arguments)})},{key:"insertHtml",value:(X=i(e().mark((function t(n){var i,a;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return(i=document.createElement("span")).innerHTML=n,i.className="chat-set-html",a=this.chatInput.createNewDom(i),this.chatInput.replaceRegContent(a,!1),t.next=8,this.chatEvent.richTextInput();case 8:return t.abrupt("return",a);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return X.apply(this,arguments)})},{key:"insertText",value:(z=i(e().mark((function t(n){var i,a,r,o,s=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(i=new RegExp("[".concat(this.chatInput.ZERO_WIDTH_KEY,"|").concat(this.chatInput.VOID_KEY,"]"),"ig"),a=n.replace(i,"")){t.next=5;break}return t.abrupt("return");case 5:return r=a.split("\n"),o="",r.forEach((function(t){var e=""!==t;o+='<p class="chat-grid-wrap" '.concat(g,'="').concat(f,'"><span ').concat(g,'="').concat(E,'"><span class="chat-grid-input" ').concat(g,'="').concat(v,'" ').concat(p,'="').concat(e?"false":"true",'">').concat(e?t:s.chatInput.VOID_KEY+"<br>","</span></span></p>")})),t.next=10,this.chatEvent.insertInsideHtml(o);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return z.apply(this,arguments)})},{key:"getCallUserList",value:function(){var t=this.chatElement.richText.querySelectorAll(".at-user");if(t&&t.length>0){var e=Array.from(t,(function(t){return t.dataset.userId}));return W(this.options.userList,e,this.options.userProps.id)}return[]}},{key:"getCallUserTagList",value:function(){var e=this,n=this.chatElement.richText.querySelectorAll(".at-user");if(n&&n.length>0){var i=[];return Array.from(n,(function(n){i.some((function(t){return t[e.options.userProps.id]===n.dataset.userId}))||i.push(t(t({},e.options.userProps.id,n.dataset.userId),e.options.userProps.name,n.textContent.slice(1)))})),i}return[]}},{key:"getCustomTagList",value:function(){var t=this,e=Object.keys(this.chatElement.customTags),n={},i=this.chatElement.richText.querySelectorAll(".at-tag");return e.forEach((function(e){var a=Array.prototype.filter.call(i,(function(t){return t.getAttribute("data-set-prefix")===String(e)})).map((function(t){return t.getAttribute("data-tag-id")}));a=a.filter((function(t,e){return a.indexOf(t)===e})),n[e]=W(t.chatElement.customTags[e],a,"id")})),n}},{key:"getSelectTagList",value:function(){var t=this,e=Object.keys(this.chatElement.selectTags),n={},i=this.chatElement.richText.querySelectorAll(".at-select");return e.forEach((function(e){var a=Array.prototype.filter.call(i,(function(t){return t.getAttribute("data-select-key")===String(e)})).map((function(t){return t.getAttribute("data-select-id")}));a=a.filter((function(t,e){return a.indexOf(t)===e})),n[e]=W(t.chatElement.selectTags[e],a,"id")})),n}},{key:"getInputTagList",value:function(){var t=this,e={},n=this.chatElement.richText.querySelectorAll(".at-input");return Array.from(n,(function(n){var i=n.getAttribute("data-input-key"),a=n.children[0].textContent===t.chatInput.VOID_KEY?null:n.children[0].textContent;e[i]||(e[i]=[]),e[i].push(a)})),e}},{key:"clear",value:(q=i(e().mark((function t(n){var i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.chatInput.initEditor(!0,n),i={html:this.chatElement.richText.innerHTML,gridIndex:0,markIndex:0,cursorIndex:this.chatInput.cursorIndex},this.chatEvent.undoHistory=[i],this.chatEvent.redoHistory=[],t.next=6,this.chatEvent.richTextInput(!1);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return q.apply(this,arguments)})},{key:"isEmpty",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((this.chatElement.richText.querySelectorAll(".chat-tag")||[]).length>0)return!1;var e=new RegExp("^(".concat(this.chatInput.ZERO_WIDTH_KEY,"|<br>|").concat(this.chatInput.VOID_KEY,")+$")),n=this.chatElement.richText.querySelectorAll(".chat-grid-input")||[];return t?Array.prototype.every.call(n,(function(t){return!t.innerHTML||!t.textContent||!t.textContent.trim()||e.test(t.innerHTML)})):Array.prototype.every.call(n,(function(t){return!t.innerHTML||!t.textContent||e.test(t.innerHTML)}))}},{key:"dispose",value:function(){if(this.options.elm.removeChild(this.chatElement.richText),this.options.elm.removeChild(this.chatElement.placeholderElm),this.options.needDialog)if(this.deviceInfo.isPc){var t=this.chatElement.pcElms.containerDialogElm.parentElement;t&&t.removeChild(this.chatElement.pcElms.containerDialogElm)}else document.body.removeChild(this.chatElement.h5Elms.dialogElm)}},{key:"showPCPointDialog",value:function(){var t=this;this.options.needDialog&&(this.insertText("@"),this.options.asyncMatch&&l(this.chatElement.pcElms.pointDialogEmptyElm,!0,"flex"),this.chatEvent.outerApply=!0,this.chatElement.showPointDialog(),D(50).then((function(){t.chatEvent.outerApply=!1})))}},{key:"showPCCheckDialog",value:function(){!this.options.needDialog||this.options.asyncMatch||(this.chatEvent.winClick(),this.chatElement.checkboxRows=[],l(this.chatElement.pcElms.checkDialogElm,!0),d(document.body,"disable-scroll",!0),this.chatElement.pcElms.checkDialogTagsElm.scrollTop=0,this.chatElement.pcElms.checkDialogUsersElm.scrollTop=0,this.chatElement.pcElms.checkDialogSearchInputElm.value="",this.chatElement.updateCheckDialogTags(),this.chatElement.isExternalCallPopup=!0)}},{key:"showPCCustomTagDialog",value:function(t){var e=this;!this.options.needDialog||this.options.asyncMatch||(this.insertText(t),this.chatEvent.outerApply=!0,this.chatElement.showCustomTagDialog(t),D(50).then((function(){e.chatEvent.outerApply=!1})))}},{key:"showPCSelectDialog",value:function(t,e){var n=this;this.chatElement.exitCustomTagDialog(),this.chatElement.exitPointDialog(),this.chatEvent.outerApply=!0,e&&(this.chatElement.exitSelectDialog(),this.chatElement.pcElms.selectDialogAim=e),this.chatElement.pcElms.selectDialogKey=t,this.chatEvent.debounceEvents.selectDialogToAim(),D(50).then((function(){n.chatEvent.outerApply=!1}))}},{key:"showH5Dialog",value:function(){this.chatElement.richText&&this.chatElement.richText.blur(),Array.from(this.chatElement.h5Elms.dialogMainElm.children,(function(t){t.style.display="",d(t,"user-popup-check-item-check")})),d(this.chatElement.h5Elms.dialogCheckElm,"disabled",!0),l(this.chatElement.h5Elms.dialogElm,!0),d(document.body,"disable-scroll",!0),this.options.asyncMatch&&l(this.chatElement.h5Elms.dialogEmptyElm,!0,"flex"),this.chatElement.h5Elms.dialogMainElm.scrollTop=0,this.chatElement.isExternalCallPopup=!0}},{key:"disabled",value:function(){this.chatElement.richText.setAttribute("contenteditable","false"),d(this.chatElement.richText,"chat-rich-text-disabled",!0)}},{key:"enable",value:function(){this.chatElement.richText.setAttribute("contenteditable","true"),d(this.chatElement.richText,"chat-rich-text-disabled"),this.chatInput.setRangeLastText()}},{key:"setUserTag",value:(j=i(e().mark((function t(n){var i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.chatEvent.triggerChatEvent("atCheck",[n]),i=this.chatInput.createChatTagElm({id:n[this.options.userProps.id],name:n[this.options.userProps.name]},"@","at-user","user-id"),this.chatInput.replaceRegContent(i,!1),t.next=5,this.chatEvent.richTextInput();case 5:this.chatEvent.triggerChatEvent("afterAtCheck",[n]);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return j.apply(this,arguments)})},{key:"setCustomTag",value:(V=i(e().mark((function t(n,i){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.chatEvent.triggerChatEvent("tagCheck",n,i),t.next=3,this.chatInput.onceCustomCall(n,!1,i);case 3:return t.next=5,this.chatEvent.richTextInput();case 5:this.chatEvent.triggerChatEvent("afterTagCheck",n,i);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return V.apply(this,arguments)})},{key:"setSelectTag",value:(Y=i(e().mark((function t(n,i){var a,r,o,s;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i||(i=this.chatElement.pcElms.selectDialogKey),this.chatEvent.triggerChatEvent("selectCheck",n,i),!this.chatElement.pcElms.selectDialogAim||!this.chatElement.pcElms.selectDialogAim.classList.contains("at-select")){t.next=7;break}if(a=this.chatElement.pcElms.selectDialogAim.getAttribute("data-select-id"),r=this.chatElement.pcElms.selectDialogAim.parentElement.nextElementSibling.childNodes[0].childNodes[0],this.chatInput.restCursorPos(r),a!==n.id){t.next=4;break}return t.abrupt("return");case 4:this.chatElement.pcElms.selectDialogAim.setAttribute("data-select-id",n.id),this.chatElement.pcElms.selectDialogAim.childNodes[0].textContent=n.name,t.next=11;break;case 7:(o=document.createElement("span")).setAttribute("class","at-select"),o.setAttribute("data-select-key",i),o.setAttribute("data-select-id",n.id),o.innerHTML="".concat(n.name).concat(P),s=this.chatInput.createNewDom(o),this.chatInput.replaceRegContent(s,!1);case 11:return t.next=13,this.chatEvent.richTextInput();case 13:this.chatEvent.triggerChatEvent("afterSelectCheck",n,i);case 14:case"end":return t.stop()}}),t,this)}))),function(t,e){return Y.apply(this,arguments)})},{key:"setInputTag",value:(F=i(e().mark((function t(n,i){var a,r,o,s,c,l=arguments;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:"",(r=document.createElement("span")).setAttribute("class","at-input"),r.setAttribute("contenteditable","false"),r.setAttribute("data-input-key",n),(o=document.createElement("span")).setAttribute("class","input-write"),o.setAttribute("contenteditable","true"),o.textContent=a||this.chatInput.VOID_KEY,(s=document.createElement("span")).setAttribute("class","input-tip"),s.textContent="["+(i||"Please input")+"]",r.appendChild(o),r.appendChild(s),c=this.chatInput.createNewDom(r),this.chatInput.replaceRegContent(c,!1),a&&this.chatInput.watchInputTag(o),this.chatInput.rangeToInputTag(r),t.next=13,this.chatEvent.richTextInput();case 13:case"end":return t.stop()}}),t,this)}))),function(t,e){return F.apply(this,arguments)})},{key:"matchSetTag",value:(L=i(e().mark((function t(n){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.chatEvent.triggerChatEvent("atCheck",[n]),t.next=3,this.chatInput.onceSearchCall(n,this.chatEvent.startOpenIndex);case 3:return t.next=5,this.chatEvent.richTextInput();case 5:this.chatEvent.triggerChatEvent("afterAtCheck",[n]);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return L.apply(this,arguments)})},{key:"onceSetTag",value:(w=i(e().mark((function t(n){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.chatEvent.triggerChatEvent("atCheck",[n]),t.next=3,this.chatInput.onceCall({id:n[this.options.userProps.id],name:n[this.options.userProps.name]});case 3:return t.next=5,this.chatEvent.richTextInput();case 5:this.chatEvent.triggerChatEvent("afterAtCheck",[n]);case 6:case"end":return t.stop()}}),t,this)}))),function(t){return w.apply(this,arguments)})},{key:"batchSetTag",value:(I=i(e().mark((function t(n){var i,a;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.chatEvent.triggerChatEvent("atCheck",n),i=[],a=0;a<=n.length-1;)i.push({id:n[a][this.options.userProps.id],name:n[a][this.options.userProps.name]}),a++;return t.next=5,this.chatInput.batchReplaceRegContent(i,!this.chatElement.isExternalCallPopup);case 5:return t.next=7,this.chatEvent.richTextInput();case 7:this.chatEvent.triggerChatEvent("afterAtCheck",n);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return I.apply(this,arguments)})},{key:"onceSetCustomTag",value:(A=i(e().mark((function t(n,i){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i||(i=this.chatElement.pcElms.customTagDialogTagKey),this.chatEvent.triggerChatEvent("tagCheck",n,i),t.next=4,this.chatInput.onceCustomCall(n,!0,i);case 4:return t.next=6,this.chatEvent.richTextInput();case 6:this.chatEvent.triggerChatEvent("afterTagCheck",n,i);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return A.apply(this,arguments)})},{key:"matchSetCustomTag",value:(k=i(e().mark((function t(n,i){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i||(i=this.chatElement.pcElms.customTagDialogTagKey),this.chatEvent.triggerChatEvent("tagCheck",n,i),t.next=4,this.chatInput.onceCustomCall(n,this.chatEvent.startOpenIndex,i);case 4:return t.next=6,this.chatEvent.richTextInput();case 6:this.chatEvent.triggerChatEvent("afterTagCheck",i);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return k.apply(this,arguments)})},{key:"undo",value:(b=i(e().mark((function t(){var n,i,a;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=this.chatEvent).doOverHistory&&n.undoHistory&&!(n.undoHistory.length<=1)){t.next=3;break}return t.abrupt("return");case 3:return i=n.undoHistory[n.undoHistory.length-2],a=n.undoHistory[n.undoHistory.length-1],n.redoHistory.push(a),n.undoHistory.pop(),t.next=8,n.setChatHistory(i);case 8:case"end":return t.stop()}}),t,this)}))),function(){return b.apply(this,arguments)})},{key:"redo",value:(C=i(e().mark((function t(){var n,i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=this.chatEvent).doOverHistory&&n.redoHistory&&!(n.redoHistory.length<1)){t.next=3;break}return t.abrupt("return");case 3:return i=n.redoHistory[n.redoHistory.length-1],n.redoHistory.pop(),n.undoHistory.push(i),t.next=8,n.setChatHistory(i);case 8:case"end":return t.stop()}}),t,this)}))),function(){return C.apply(this,arguments)})},{key:"cursorMove",value:function(t){if(0!==t){var e=new RegExp("[".concat(this.chatInput.ZERO_WIDTH_KEY,"|").concat(this.chatInput.VOID_KEY,"]"),"ig");if(t>0){var n=this.chatInput.vnode.textContent.replace(e,"").slice(this.chatInput.cursorIndex);if(n.length>=t)return this.chatInput.cursorIndex+=t,void this.chatInput.restCursorPos(this.chatInput.vnode,this.chatInput.cursorIndex);var i=this.chatInput.vnode.parentElement.parentElement,a=i.parentElement,r=!(!i.nextElementSibling||!i.nextElementSibling.nextElementSibling),o=!!a.nextElementSibling;if(!r&&!o)return this.chatInput.cursorIndex+=n.length,0===this.chatInput.cursorIndex&&(this.chatInput.cursorIndex=1),void this.chatInput.restCursorPos(this.chatInput.vnode,this.chatInput.cursorIndex);var s=t-n.length-1,c=r?i.nextElementSibling.nextElementSibling:a.nextElementSibling.children[0],l=this.chatInput.getOffsetRange(s,c),u=l.rangeNode,h=l.rangeIndex;this.chatInput.restCursorPos(u,h)}else if(t<0){var d=Math.abs(t),p=this.chatInput.vnode.textContent.replace(e,"").slice(0,this.chatInput.cursorIndex);if(p.length>=d)return this.chatInput.cursorIndex-=d,void this.chatInput.restCursorPos(this.chatInput.vnode,this.chatInput.cursorIndex);var g=this.chatInput.vnode.parentElement.parentElement,m=g.parentElement,f=!(!g.previousElementSibling||!g.previousElementSibling.previousElementSibling),E=!!m.previousElementSibling;if(!f&&!E)return void this.chatInput.restCursorPos(this.chatInput.vnode);d=d-p.length-1;var v=f?g.previousElementSibling.previousElementSibling:m.previousElementSibling.lastElementChild,x=this.chatInput.getOffsetRange(d,v,!0),D=x.rangeNode,y=x.rangeIndex;this.chatInput.restCursorPos(D,y)}}else this.chatInput.restCursorPos(this.chatInput.vnode,this.chatInput.cursorIndex)}},{key:"cursorDel",value:(m=i(e().mark((function t(n){var i,a,r,o,s,c;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==n){t.next=3;break}return this.chatInput.restCursorPos(this.chatInput.vnode,this.chatInput.cursorIndex),t.abrupt("return");case 3:if(i=this.chatInput.vnode,a=this.chatInput.cursorIndex,this.cursorMove(n),r=this.chatInput.vnode,o=this.chatInput.cursorIndex,s=document.createRange(),n<0?(s.setStart(r,o),s.setEnd(i,a)):(s.setStart(i,a),s.setEnd(r,o)),(c=window.getSelection()).removeAllRanges(),c.addRange(s),t.t0=this.chatInput.selectRegionMerge()||this.chatInput.gridElmMerge()||this.chatInput.delMarkRule(),!t.t0){t.next=14;break}return t.next=14,this.chatEvent.richTextInput();case 14:case"end":return t.stop()}}),t,this)}))),function(t){return m.apply(this,arguments)})},{key:"delUserTags",value:(h=i(e().mark((function t(n){var i,a,r,o,s,c=this;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=n||this.options.userList.map((function(t){return t[c.options.userProps.id]})),a=this.chatElement.richText.querySelectorAll(".at-user"),r=[],Array.from(a,(function(t){var e=t.getAttribute("data-user-id");i.some((function(t){return String(t)===e}))&&r.push(t.parentElement)})),o=0;o<r.length;)s=r[o],this.chatInput.delTag(s),o++;return this.chatInput.setRangeLastText(),t.next=6,this.chatEvent.richTextInput();case 6:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"delCustomTags",value:(u=i(e().mark((function t(n,i){var a,r,o,s,c,l;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.options.customTrigger.find((function(t){return t.prefix===n})),a&&0!==a.tagList.length){t.next=3;break}return t.abrupt("return");case 3:for(r=i||a.tagList.map((function(t){return t.id})),o=this.chatElement.richText.querySelectorAll(".at-tag"),s=[],Array.from(o,(function(t){var e=t.getAttribute("data-set-prefix"),i=t.getAttribute("data-tag-id");e===n&&r.some((function(t){return String(t)===i}))&&s.push(t.parentElement)})),c=0;c<s.length;)l=s[c],this.chatInput.delTag(l),c++;return this.chatInput.setRangeLastText(),t.next=9,this.chatEvent.richTextInput();case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"delSelectTags",value:(c=i(e().mark((function t(n,i){var a,r,o,s,c,l;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.options.selectList.find((function(t){return t.key===n})),a&&0!==a.options.length){t.next=3;break}return t.abrupt("return");case 3:for(r=i||a.options.map((function(t){return t.id})),o=this.chatElement.richText.querySelectorAll(".at-select"),s=[],Array.from(o,(function(t){var e=t.getAttribute("data-select-key"),i=t.getAttribute("data-select-id");e===n&&r.some((function(t){return String(t)===i}))&&s.push(t.parentElement)})),c=0;c<s.length;)l=s[c],this.chatInput.delTag(l),c++;return this.chatInput.setRangeLastText(),t.next=9,this.chatEvent.richTextInput();case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return c.apply(this,arguments)})},{key:"delInputTags",value:(r=i(e().mark((function t(n){var i,a,r,o;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=this.chatElement.richText.querySelectorAll(".at-input"),a=[],Array.from(i,(function(t){if(n){var e=t.getAttribute("data-input-key");n.some((function(t){return String(t)===e}))&&a.push(t.parentElement)}else a.push(t.parentElement)})),r=0;r<a.length;)o=a[r],this.chatInput.delTag(o),r++;return this.chatInput.setRangeLastText(),t.next=6,this.chatEvent.richTextInput();case 6:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"openTipTag",value:function(t){this.chatElement.createTipElm(t),this.chatInput.setRangeLastText()}},{key:"closeTipTag",value:function(){this.chatElement.tipElm&&this.chatElement.removeTipElm()}},{key:"addEventListener",value:function(t,e){this.chatEvent.chatEventModule[t].push(e)}},{key:"removeEventListener",value:function(t,e){var n=this.chatEvent.chatEventModule[t],i=n.indexOf(e);-1!==i&&n.splice(i,1)}},{key:"revisePCPointDialogLabel",value:function(t){this.options.needDialog&&(this.options.dialogLabels.pcPointDialog=Object.assign({},_,t||{}),this.chatElement.pcElms.pointDialogElm.querySelector(".call-user-dialog-header-title").textContent=this.options.dialogLabels.pcPointDialog.title,this.chatElement.pcElms.pointDialogCheckElm.textContent=this.options.dialogLabels.pcPointDialog.checkLabel,this.chatElement.pcElms.pointDialogEmptyElm&&(this.chatElement.pcElms.pointDialogEmptyElm.children[1].textContent=this.options.dialogLabels.pcPointDialog.emptyLabel),this.options.asyncMatch||this.updateUserList())}},{key:"revisePCCheckDialogLabel",value:function(t){!this.options.needDialog||this.options.asyncMatch||(this.options.dialogLabels.pcPCheckDialog=Object.assign({},K,t||{}),this.chatElement.pcElms.checkDialogElm.querySelector(".checkbox-dialog-container-header").children[0].textContent=this.options.dialogLabels.pcPCheckDialog.title,this.chatElement.pcElms.checkDialogSearchInputElm.setAttribute("placeholder",this.options.dialogLabels.pcPCheckDialog.searchPlaceholder),this.chatElement.pcElms.checkDialogElm.querySelector(".checkbox-dialog-search-empty").textContent=this.options.dialogLabels.pcPCheckDialog.searchEmptyLabel,this.chatElement.pcElms.checkDialogElm.querySelector(".checkbox-dialog-right-box-title").textContent=this.options.dialogLabels.pcPCheckDialog.userTagTitle,this.chatElement.pcElms.checkDialogUsersElm.children[0].children[2].textContent=this.options.dialogLabels.pcPCheckDialog.checkAllLabel,this.chatElement.pcElms.checkDialogElm.querySelector(".btn-submit").textContent=this.options.dialogLabels.pcPCheckDialog.confirmLabel,this.chatElement.pcElms.checkDialogElm.querySelector(".btn-close").textContent=this.options.dialogLabels.pcPCheckDialog.cancelLabel)}},{key:"reviseH5DialogLabel",value:function(t){this.options.needDialog&&(this.options.dialogLabels.h5Dialog=Object.assign({},H,t||{}),this.chatElement.h5Elms.dialogElm.querySelector(".popup-title").textContent=this.options.dialogLabels.h5Dialog.title,this.chatElement.h5Elms.dialogSearchElm.setAttribute("placeholder",this.options.dialogLabels.h5Dialog.searchPlaceholder),this.chatElement.h5Elms.dialogEmptyElm.children[1].textContent=this.options.dialogLabels.h5Dialog.searchEmptyLabel,this.chatElement.h5Elms.dialogCheckElm.textContent=this.options.dialogLabels.h5Dialog.confirmLabel,this.chatElement.h5Elms.dialogShowElm.textContent=this.options.dialogLabels.h5Dialog.cancelLabel,this.options.asyncMatch||this.updateUserList())}},{key:"createOperateNode",value:function(){return new G(this)}},{key:"nextTick",value:(n=i(e().mark((function t(n){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){requestAnimationFrame((function(){var e=n();e instanceof Promise?e.then((function(){t()})):t()}))})));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})}]);var n,r,c,u,h,m,C,b,k,A,I,w,L,F,Y,V,j,q,z,X,Z}();if(!window)throw new Error("非web环境！");window.console&&window.console.log&&console.log(" %c ".concat("ChatArea"," %c v5.6.3 "),"background: #269AFF; color: #FFFFFF; padding: 4px 0; border-radius: 4px 0px 0px 4px; font-style: italic;","background: #FFFFFF; color: #269AFF; padding: 2px 0; border-radius: 0px 4px 4px 0px; font-style: italic; border: 2px solid #269AFF;"),window.ChatArea=j;n("C",window.ChatArea)}}}))}();
